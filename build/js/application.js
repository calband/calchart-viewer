!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=22)}([function(t,e){var n={extends:function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n},getURLValue:function(t){var e=this.getAllURLParams();return void 0!==e[t]?e[t]:null},getAllURLParams:function(){for(var t={},e=window.location.search.substr(1).split("&"),n=0;n<e.length;n++){var i=e[n].split("="),o=decodeURIComponent(i[0]),r=decodeURIComponent(i[1]);t[o]=r}return t}};t.exports=n},function(t,e,n){var i=n(16),o=function(t,e,n,i,o){this._startX=t,this._startY=e,this._endX=n,this._endY=i,this._numBeats=o};o.prototype.getStartPosition=function(){return new i(this._startX,this._startY)},o.prototype.getEndPosition=function(){return new i(this._endX,this._endY)},o.prototype.getBeatDuration=function(){return this._numBeats},o.prototype.getAnimationState=function(t){console.log("getAnimationState called")},o.prototype.getContinuityText=function(){console.log("getContinuityText called")},o.prototype.getOrientation=function(){switch(this._orientation){case 0:return"E";case 90:return"S";case 180:return"W";case 270:return"N";default:return""}},t.exports=o},function(t,e){t.exports=function(t,e,n){this.x=t,this.y=e,this.angle=n}},function(t,e){var n=function(t,e,n){this._major=t,this._minor=e,this._revision=n};n.prototype.stringify=function(){return this._major+"."+this._minor+"."+this._revision},n.prototype.compareTo=function(t){var e=this._major-t._major;return 0!=e?e:0!=(e=this._minor-t._minor)?e:e=this._revision-t._revision},n.parse=function(t){var e=t.split(".");return new n(parseInt(e[0]),parseInt(e[1]),parseInt(e[2]))},t.exports=n},,,function(t,e){MathUtils={},MathUtils.PI_OVER_TWO=Math.PI/2,MathUtils.TWO_PI=2*Math.PI,MathUtils.DEGREES_TO_RADIANS_CONV_FACTOR=Math.PI/180,MathUtils.RADIANS_TO_DEGREES_CONV_FACTOR=1/MathUtils.DEGREES_TO_RADIANS_CONV_FACTOR,MathUtils.calcSquaredDistance=function(t,e,n,i){var o=n-t,r=i-e;return o*o+r*r},MathUtils.calcDistance=function(t,e,n,i){return Math.sqrt(this.calcSquaredDistance(t,e,n,i))},MathUtils.calcAngle=function(t,e){var n=Math.atan(-t/e);return e<0&&(n+=Math.PI),n},MathUtils.calcAngleAbout=function(t,e,n,i){return this.calcAngle(t-n,e-i)},MathUtils.calcRotatedXPos=function(t){return-Math.sin(t)},MathUtils.calcRotatedYPos=function(t){return Math.cos(t)},MathUtils.quarterTurn=function(t,e){return t+(2*e-1)*this.PI_OVER_TWO},MathUtils.wrapAngleDegrees=function(t){for(;t>=360;)t-=360;for(;t<0;)t+=360;return t},MathUtils.wrapAngleRadians=function(t){for(;t>=TWO_PI;)t-=this.TWO_PI;for(;t<0;)t+=this.TWO_PI;return t},MathUtils.toRadians=function(t){return t*this.DEGREES_TO_RADIANS_CONV_FACTOR},MathUtils.toDegrees=function(t){return t*this.RADIANS_TO_DEGREES_CONV_FACTOR},t.exports=MathUtils},function(t,e,n){var i=n(8),o=(n(3),function(){this._loaders=[]});o.prototype.registerLoader=function(t,e){var n=i.binarySearchForClosestLarger(this._loaders,t,o._versionLocator),r={version:t,loader:e};this._loaders.splice(n,0,r)},o.prototype.getAppropriateLoader=function(t){var e=i.binarySearchForClosestSmaller(this._loaders,t,o._versionLocator);return this._loaders[e].loader},o._versionLocator=function(t,e){return t.compareTo(e.version)},(o.FileLoader=function(){}).prototype.loadFile=function(t){console.log("FileLoader.loadFile(...) called")},t.exports=o},function(t,e){var n={binarySearchBase:function(t,e){for(var n,i,o,r,a=t.length,s=0;a>0&&0!==(i=e(t[o=s+(n=Math.floor(a/2))],o));)i>0?(s+=r=n+1,a-=r):a=n},binarySearchForClosestLarger:function(t,e,i){var o;return n.binarySearchBase(t,function(t,n){var r=i(e,t);return r<=0&&(o=n),r}),o},binarySearchForClosestSmaller:function(t,e,i){var o;return n.binarySearchBase(t,function(t,n){var r=i(e,t);return r>=0&&(o=n),r}),o},binarySearch:function(t,e,i){var o;return n.binarySearchBase(t,function(t,n){var r=i(e,t);return 0===r&&(o=n),r}),o},mergeSortedArrays:function(t,e,n){for(var i=0,o=0,r=[];i<t.length&&o<e.length;)n(t[i],e[o])<0?(r.push(t[i]),i++):(r.push(e[o]),o++);for(;i<t.length;i++)r.push(t[i]);for(;o<e.length;o++)r.push(e[o]);return r}};t.exports=n},function(t,e){t.exports=function(t){this.message=t,this.name="InvalidFileTypeError"}},function(t,e,n){var i=n(11),o=n(3),r={fromJSONString:function(t){var e=JSON.parse(t);return this.fromJSON(e)},fromJSON:function(t){var e=o.parse(t.meta.version);return i.getInstance().getAppropriateLoader(e).loadFile(t)}};t.exports=r},function(t,e,n){var i=n(7),o=n(9),r=n(0),a=n(3),s=n(12),l=n(13),u=n(14),h=n(15),c=n(17),p=n(18),d=n(19),_=n(20),f=n(21),g=function(){i.apply(this,[])};r.extends(g,i),g._instance=void 0,g.getInstance=function(){return void 0===g._instance&&(g._instance=new g,g._setupInstance(g._instance)),g._instance},g._setupInstance=function(t){t.registerLoader(new a(1,0,0),new y)},g.ViewerFileLoader=function(){},r.extends(g.ViewerFileLoader,i.FileLoader);var y=function(){};r.extends(y,g.ViewerFileLoader),y.prototype.loadFile=function(t){return this.loadShow(t.show)},y.prototype.loadShow=function(t){if(void 0===t)throw new o("Please upload a proper viewer file.");var e=new u(t.title,t.year,t.description,t.labels);return this.loadSheets(e,t.sheets),e},y.prototype.loadSheets=function(t,e){for(var n=0;n<e.length;n++)t.appendSheet(this.buildIndividualSheet(e[n]))},y.prototype.buildIndividualSheet=function(t){return new l(t.label,t.field_type,t.dot_types,t.dot_labels,t.continuities,t.beats,this.buildDots(t.movements),Object.keys(t.movements))},y.prototype.buildDots=function(t){var e=[];for(var n in t)e.push(new s(n,this.buildDotMovements(t[n])));return e},y.prototype.buildDotMovements=function(t){for(var e=[],n=0;n<t.length;n++)e.push(this.buildIndividualMovement(t[n]));return e},y.prototype.buildIndividualMovement=function(t){switch(t.type){case"stand":return this.buildStandMovement(t);case"mark":return this.buildMarkMovement(t);case"move":return this.buildMoveMovement(t);case"goto":return this.buildGotoMovement(t);case"arc":return this.buildArcMovement(t);case"even":return this.buildEvenMovement(t);default:throw new TypeError("Movement type unrecognized.")}},y.prototype.buildStandMovement=function(t){return new h(t.x,t.y,t.facing,t.beats)},y.prototype.buildMarkMovement=function(t){return new c(t.x,t.y,t.facing,t.beats)},y.prototype.buildMoveMovement=function(t){return new d(t.start_x,t.start_y,t.step_size,t.direction,t.facing,t.beats,t.beats_per_step)},y.prototype.buildGotoMovement=function(t){return new _(t.from_x,t.from_y,t.to_x,t.to_y,t.facing,t.beats)},y.prototype.buildArcMovement=function(t){return new p(t.start_x,t.start_y,t.center_x,t.center_y,t.angle,t.facing_offset,t.beats,t.beats_per_step)},y.prototype.buildEvenMovement=function(t){return new f(t.x1,t.y1,t.x2,t.y2,t.facing,t.beats,t.beats_per_step)},t.exports=g},function(t,e){var n=function(t,e){this._label=t,this._movements=e};n.prototype.getLabel=function(){return this._label},n.prototype.getMovementCommands=function(){return this._movements},n.prototype.getAnimationState=function(t){for(var e=0;e<this._movements.length;e++){if(t<this._movements[e].getBeatDuration())return this._movements[e].getAnimationState(t);t-=this._movements[e].getBeatDuration()}},t.exports=n},function(t,e){var n=function(t,e,n,i,o,r,a,s){this._sheetLabel=t,this._fieldType=e,this._dotTypes=n,this._dotTypeAssignments=i,this._continuityTexts=o,this._duration=r,this._dots=a,this._dotLabels=s};n.prototype.getSheetLabel=function(){return this._sheetLabel},n.prototype.getFieldType=function(){return this._fieldType},n.prototype.getAllDotTypes=function(){return this._dotTypes},n.prototype.getDotType=function(t){return this._dotTypeAssignments[t]},n.prototype.getContinuityTexts=function(t){return this._continuityTexts[t]},n.prototype.getDots=function(){return this._dots},n.prototype.getDotByLabel=function(t){var e=this._dotLabels.indexOf(t);return-1===e?null:this._dots[e]},n.prototype.getDuration=function(){return this._duration},t.exports=n},function(t,e){var n=function(t,e,n,i,o){this._title=t,this._year=e,this._description=n,this._dotLabels=i,this._sheets=void 0===o?[]:o};n.prototype.getTitle=function(){return this._title},n.prototype.getYear=function(){return this._year},n.prototype.getDescription=function(){return this._description},n.prototype.getDotLabels=function(){return this._dotLabels},n.prototype.getSheets=function(){return this._sheets},n.prototype.getSheet=function(t){return this._sheets[t]},n.prototype.getNumSheets=function(){return this._sheets.length},n.prototype.appendSheet=function(t){this._sheets.push(t)},t.exports=n},function(t,e,n){var i=n(0),o=n(1),r=n(2),a=function(t,e,n,i){this._orientation=n,o.apply(this,[t,e,t,e,i])};i.extends(a,o),a.prototype.getAnimationState=function(t){return new r(this._startX,this._startY,this._orientation)},a.prototype.getContinuityText=function(){return"Close "+this._numBeats+this.getOrientation()},t.exports=a},function(t,e){t.exports=function(t,e){this.x=t,this.y=e}},function(t,e,n){var i=n(0),o=n(1),r=n(2),a=function(t,e,n,i){this._orientation=n,o.apply(this,[t,e,t,e,i])};i.extends(a,o),a.prototype.getAnimationState=function(t){return new r(this._startX,this._startY,this._orientation)},a.prototype.getContinuityText=function(){return 0==this._numBeats?"":"MT "+this._numBeats+" "+this.getOrientation()},t.exports=a},function(t,e,n){var i=n(0),o=n(6),r=n(1),a=n(2),s=function(t,e,n,i,a,s,l,u){this._beatsPerStep=u,this._centerX=n,this._centerY=i,this._radius=o.calcDistance(t,e,this._centerX,this._centerY),this._startAngle=o.calcAngleAbout(t,e,n,i),isNaN(this._startAngle)&&(this._startAngle=0),this._stepAngleDelta=o.toRadians(a)/Math.floor(l/this._beatsPerStep),this._movementIsCW=this._stepAngleDelta>=0,this._orientationOffset=o.toRadians(s);var h=this.getAnimationState(l);r.apply(this,[t,e,h.x,h.y,l])};i.extends(s,r),s.prototype.getAnimationState=function(t){var e=Math.floor(t/this._beatsPerStep),n=this._startAngle+this._stepAngleDelta*e,i=this._radius*o.calcRotatedXPos(n)+this._centerX,r=this._radius*o.calcRotatedYPos(n)+this._centerY,s=o.quarterTurn(n,this._movementIsCW)+this._orientationOffset;return new a(i,r,o.toDegrees(s))},s.prototype.getMiddlePoints=function(){for(var t=this._startAngle,e=this._startX,n=this._startY,i=[],r=0;r<this._numBeats/this._beatsPerStep;r++){t+=this._stepAngleDelta;var a=this._radius*o.calcRotatedXPos(t)+this._centerX,s=this._radius*o.calcRotatedYPos(t)+this._centerY;i.push([a-e,s-n]),e=a,n=s}return i},s.prototype.getContinuityText=function(){var t=this._numBeats/this._beatsPerStep;return"GT "+(this._movementIsCW?"CW":"CCW")+" "+Math.abs(Math.floor(o.toDegrees(this._numBeats*this._stepAngleDelta)))+" deg. ("+t+" steps)"},t.exports=s},function(t,e,n){var i=n(0),o=n(6),r=n(1),a=n(2),s=function(t,e,n,i,a,s,l){i=o.toRadians(i),this._deltaXPerStep=o.calcRotatedXPos(i)*n,this._deltaYPerStep=o.calcRotatedYPos(i)*n,this._orientation=a,this._beatsPerStep=l,numSteps=Math.floor(s/this._beatsPerStep),r.apply(this,[t,e,t+this._deltaXPerStep*numSteps,e+this._deltaYPerStep*numSteps,s])};i.extends(s,r),s.prototype.getAnimationState=function(t){return numSteps=Math.floor(t/this._beatsPerStep),new a(this._startX+this._deltaXPerStep*numSteps,this._startY+this._deltaYPerStep*numSteps,this._orientation)},s.prototype.getContinuityText=function(){var t=this._endX-this._startX,e=this._endY-this._startY,n=t<0?"S":"N",i=e<0?"W":"E";return 0==t?"Move "+Math.abs(e)+" "+i:"Move "+Math.abs(t)+" "+n},t.exports=s},function(t,e,n){var i=n(0),o=n(1),r=n(2),a=function(t,e,n,i,r,a){this._orientation=r,o.apply(this,[t,e,n,i,a])};i.extends(a,o),a.prototype.getAnimationState=function(t){return new r(this._endX,this._endY,this._orientation)},a.prototype.getContinuityText=function(){return"See Continuity ("+this._numBeats+" beats)"},t.exports=a},function(t,e,n){var i=n(0),o=n(1),r=n(2),a=function(t,e,n,i,r,a,s){this._orientation=r,this._beatsPerStep=s;var l=Math.floor(a/this._beatsPerStep);this._deltaXPerStep=(n-t)/l,this._deltaYPerStep=(i-e)/l,o.apply(this,[t,e,n,i,a])};i.extends(a,o),a.prototype.getAnimationState=function(t){var e=Math.floor(t/this._beatsPerStep);return new r(this._startX+this._deltaXPerStep*e,this._startY+this._deltaYPerStep*e,this._orientation)},a.prototype.getBeatsPerStep=function(){return this._beatsPerStep},a.prototype.getContinuityText=function(){var t=this._endX-this._startX,e=this._endY-this._startY,n=t<0?"S":"N",i=e<0?"W":"E",o=this._numBeats/this._beatsPerStep;if(t=Math.abs(t),e=Math.abs(e),0==t&&e==o)return"Move "+o+" "+i;if(0==e&&t==o)return"Move "+o+" "+n;if(e==t&&t==o)return"Move "+o+" "+n+i;var r="Even ";if(t%1!=0||e%1!=0)r+=0!=t?n:"",r+=0!=e?i:"";else{var a=[];0!=e&&a.push(Math.abs(e)+" "+i),0!=t&&a.push(Math.abs(t)+" "+n),r+=a.join(", ")}return"Even "===r&&(r+="0"),r+" ("+o+" steps)"},t.exports=a},function(t,e,n){var i=n(23),o=n(0),r=null,a=function(t,e){var n="mousedown",i="mouseup mouseleave";if(void 0!==window.ontouchstart)n="touchstart",i="touchend touchcancel";$(t).on(n,function(){e(),r=setTimeout(function(){r=setInterval(e,50)},500)}).on(i,function(){clearTimeout(r)})};$(document).ready(function(){$(".header-feedback-link").click(function(){window.location="mobile.html"});var t=i.getInstance();t.init(),$(".js-beats-file-btn").click(function(){$(".js-beats-file").click()}),$(".js-beats-file").change(t.getBeatsFileHandler()),$(".js-viewer-file-btn").click(function(){$(".js-viewer-file").click()}),$(".js-viewer-file").change(t.getViewerFileHandler()),$(".js-audio-file-btn").click(function(){$(".js-audio-file").click()}),$(".js-audio-file").change(t.getMusicFileHandler()),$(".js-load-song").click(t.mobileMusicLoader()),a(".js-prev-beat",function(){t.applyAnimationAction("prevBeat")}),$(".js-prev-stuntsheet").click(function(){t.applyAnimationAction("prevSheet")}),a(".js-next-beat",function(){t.applyAnimationAction("nextBeat")}),$(".js-next-stuntsheet").click(function(){t.applyAnimationAction("nextSheet")}),$(window).keydown(function(e){if(39===e.keyCode)t.applyAnimationAction("nextBeat");else if(37===e.keyCode)t.applyAnimationAction("prevBeat");else if(32===e.keyCode){var n=t.getAnimator();n&&n.isReady()&&t.toggleAnimation()}}),$(".js-animate").click(function(){t.toggleAnimation()}),$(".js-generate-continuity").click(function(){var t=$(".js-select-show").val(),e=$(".js-dot-labels").val();window.location.href="pdf.html?show="+t+"&dots="+e+"&md-orientation=west&bev-orientation=west&sd-orientation=west&layout-order=ltr"}),$(".js-dot-labels").chosen({allow_single_deselect:!0,width:"90px"}).change(function(e,n){n?t.applyAnimationAction("selectDot",n.selected):t.applyAnimationAction("clearSelectedDot")}),$(".js-select-show").chosen({width:"150px",disable_search_threshold:4,allow_single_deselect:!0}).change(function(){window.location.search="show="+$(this).val()}),t.getShows().complete(function(){var e=o.getAllURLParams();t.autoloadShow(e.show,e.dot)}).error(function(t){alert("Could not load shows from the server"),$(".loading").remove()})})},function(t,e,n){var i=n(24),o=n(10),r=n(25),a=n(28),s=n(29),l=n(34),u=window.ApplicationController=function(){this._musicPlayer=null,this._animationStateDelegate=null,this._grapher=null,this._show=null,this._animator=null};u.prototype.getShow=function(){return this._show},u.prototype.setShow=function(t){this._show=t,this._animationStateDelegate=new l(this._show),this._animator.setAnimationStateDelegate(this._animationStateDelegate),this._syncWithDelegate(),this._updateUIWithShow()},u.prototype.getShows=function(){return $.ajax({url:"https://calchart-server.herokuapp.com/list/",dataType:"json",xhr:function(){var t=$.ajaxSettings.xhr();return t.onprogress=function(t){if(t.lengthComputable){var e=t.loaded/t.total;$(".loading .progress-bar").css({width:35*e+"%"})}},t},success:function(t){$("<option>").appendTo(".js-select-show"),t.shows.forEach(function(t){$("<option>").attr("value",t.slug).text(t.name).appendTo(".js-select-show")}),$(".js-select-show").trigger("chosen:updated")}})},u.prototype.autoloadShow=function(t,e){if(""!==t&&void 0!==t){$(".js-select-show option[value="+t+"]").prop("selected",!0),$(".js-select-show").trigger("chosen:updated");var n=this;$.ajax({url:"https://calchart-server.herokuapp.com/get/"+t+"/",dataType:"json",xhr:function(){var t=$.ajaxSettings.xhr();return t.onprogress=function(t){if(t.lengthComputable){var e=t.loaded/t.total;$(".loading .progress-bar").css({width:35+65*e+"%"})}},t},success:function(i){var a=o.fromJSON(i.viewer);n.setShow(a),n._setFileInputText(".js-viewer-file-btn",t),void 0!==e&&""!==e&&(n.applyAnimationAction("selectDot",e),$("option[value="+e+"]").prop("selected",!0),$(".js-dot-labels").trigger("chosen:updated"));var s=i.beats.meta?i.beats:JSON.parse(i.beats),l=r.fromJSON(s);if(n._animator.setBeats(l),n._setFileInputText(".js-beats-file-btn",t),null===i.audio)$(".loading").remove();else{if(window.isMobile)return $(".loading").remove(),void $(".js-load-song span").text(i.audio);var u=n._musicPlayer.createSound();u.registerEventHandler("finishedLoading",function(){n._animator.setMusic(u),n._setFileInputText(".js-audio-file-btn",t),$(".loading").remove()}),u.load(i.audio)}}})}else $(".loading").remove()},u.prototype._updateUIWithShow=function(){void 0===this._show.getTitle()?$(".js-show-title").text("Untitled Show"):$(".js-show-title").text(this._show.getTitle()),this._show.getDotLabels().forEach(function(t){$("<option>").attr("value",t).attr("data-dot-label",t).text(t).appendTo(".js-dot-labels")}),$(".js-dot-labels").trigger("chosen:updated")},u.prototype.getAnimator=function(){return this._animator},u.prototype.getAnimationStateDelegate=function(){return this._animationStateDelegate},u.prototype.applyAnimationAction=function(t){if(null!==this._animationStateDelegate&&-1!==["prevSheet","nextSheet","prevBeat","nextBeat","selectDot","clearSelectedDot"].indexOf(t)){var e=!1;this._animator.isPlaying()&&(this._animator.stop(),e=!0),-1!==["selectDot"].indexOf(t)?this._animationStateDelegate[t]([].slice.call(arguments)[1]):this._animationStateDelegate[t](),this._syncWithDelegate(),e&&this._animator.start()}},u.prototype._syncWithDelegate=function(){this._updateUIWithAnimationState(),this._grapher.draw(this._animationStateDelegate.getCurrentSheet(),this._animationStateDelegate.getCurrentBeatNum(),this._animationStateDelegate.getSelectedDot())},u.prototype._updateUIWithAnimationState=function(){$(".js-stuntsheet-total").text(this._animationStateDelegate.getCurrentSheet().getDuration());var t=this._animationStateDelegate.getCurrentBeatNum();0===t?$(".js-beat-number").text("Hup"):$(".js-beat-number").text(t);var e=this._animationStateDelegate.getCurrentSheetNum()+1,n=e+"/"+this.getShow().getNumSheets(),i=this._animationStateDelegate.getCurrentSheet().getSheetLabel();if(""===i||parseInt(i)===e?$(".js-stuntsheet-label").text(n):$(".js-stuntsheet-label").text(i+" ("+n+")"),$(".js-dot-continuity").empty(),null!==this._animationStateDelegate.getSelectedDot()){var o=this._animationStateDelegate.getSelectedDot();$(".js-selected-dot-label").text(o);var r=this._animationStateDelegate.getCurrentSheet(),a=r.getDotType(o),s=r.getContinuityTexts(a);void 0!==s&&s.forEach(function(t){$("<div>").addClass("dot-continuity").text(t).appendTo(".js-dot-continuity")})}else $(".js-selected-dot-label").text("dots")},u._instance=null,u.getInstance=function(){return null===u._instance&&(u._instance=new u),u._instance},u.prototype.init=function(){this._musicPlayer=(new s).createMusicPlayer(),this._animator=new a;var t=this;this._animator.registerEventHandler("beat",function(){t._syncWithDelegate()}),this._animator.registerEventHandler("ready",function(){t._updateAnimationControl()}),this._animator.registerEventHandler("finished",function(){t._updateAnimationControl()}),this._grapher=new i("college",$(".js-grapher-draw-target")),this._grapher.draw(null,null,null)},u.prototype._setFileInputText=function(t,e){e.length>16&&(e=e.substring(0,16)+"..."),$(t).text(e)},u.prototype._createFileHandler=function(t){return function(e){var n=e.currentTarget.files;if(n&&1===n.length){var i=new window.FileReader;i.onload=function(){t(i.result,n[0].name)},i.readAsText(n[0])}}},u.prototype._createFileURLHandler=function(t){return function(e){var n=e.currentTarget.files;n&&1===n.length&&t(URL.createObjectURL(n[0]),n[0].name)}},u.prototype.getBeatsFileHandler=function(){var t=this;return this._createFileHandler(function(e,n){try{var i=r.fromJSONString(e);t._animator.setBeats(i),t._setFileInputText(".js-beats-file-btn",n)}catch(e){$(".js-beats-file").val(""),"SyntaxError"===e.name?t.displayFileInputError("Please upload a valid beats file."):"InvalidFileTypeError"===e.name&&t.displayFileInputError(e.message)}})},u.prototype.getViewerFileHandler=function(){var t=this;return this._createFileHandler(function(e,n){try{var i=o.fromJSONString(e);t.setShow(i),t._setFileInputText(".js-viewer-file-btn",n)}catch(e){$(".js-viewer-file").val(""),"SyntaxError"===e.name?t.displayFileInputError("Please upload a valid viewer file."):"InvalidFileTypeError"===e.name&&t.displayFileInputError(e.message)}})},u.prototype.getMusicFileHandler=function(){var t=this;return this._createFileURLHandler(function(e,n){if(void 0!==e){var i=t._musicPlayer.createSound();i.registerEventHandler("finishedLoading",function(){i.errorFlag()?($(".js-audio-file").val(""),t.displayFileInputError("Please upload a valid audio file.")):(t._animator.setMusic(i),t._setFileInputText(".js-audio-file-btn",n))}),i.load(e)}})},u.prototype.mobileMusicLoader=function(){var t=this;return function(){var e=t._musicPlayer.createSound();e.registerEventHandler("finishedLoading",function(){e.errorFlag()?t.displayFileInputError("Please upload a valid audio file."):t._animator.setMusic(e)}),e.load($(this).children("span").text())}},u.prototype.displayFileInputError=function(t){$(".file-input-error").text(t).fadeIn(1e3).delay(1e3).fadeOut(500)},u.prototype.toggleAnimation=function(){this._animator.isPlaying()?this._animator.stop():this._animator.isReady()?this._animator.start():console.log("Animator is not ready!"),this._updateAnimationControl()},u.prototype._updateAnimationControl=function(){this._animator.isPlaying()?window.isMobile?$(".js-animate").addClass("playing"):$(".js-animate").text("Stop animation"):(window.isMobile?$(".js-animate").removeClass("playing"):$(".js-animate").text("Animate with music"),this._animator.isReady()?$(".js-animate").removeClass("disabled"):$(".js-animate").addClass("disabled"))},t.exports=u},function(t,e){var n=function(t,e){if(!d3)throw new TypeError("Cannot load grapher because d3 was not found.");this._fieldType=t,this._drawTarget=e,this._svgWidth=parseInt(this._drawTarget.css("width"),10),this._svgHeight=parseInt(this._drawTarget.css("height"),10),this._svg=d3.select(this._drawTarget.get(0)).append("svg").attr("width",this._svgWidth).attr("height",this._svgHeight)};n.COLLEGE_FIELD_ASPECT_RATIO=.5333,n.COLLEGE_FIELD_STEPS_HORIZONTAL=160,n.COLLEGE_FIELD_STEPS_VERTICAL=84,n.prototype.setFieldType=function(t){this._fieldType=t},n.prototype.getFieldType=function(){return this._fieldType},n.prototype.draw=function(t,e,n){this._clearSvg(),"college"===this._fieldType&&this._drawCollegeField(),t&&e>=0&&this._drawStuntsheetAtBeat(t,e,n)},n.COLLEGE_FIELD_PADDING={left:10,right:10},n.prototype._getVerticalStepScale=function(t){var e=(this._svgWidth-t.left-t.right)*n.COLLEGE_FIELD_ASPECT_RATIO,i=(this._svgHeight-e)/2,o=i,r=this._svgHeight-i;return d3.scale.linear().domain([0,n.COLLEGE_FIELD_STEPS_VERTICAL]).range([o,r])},n.prototype._getHorizontalStepScale=function(t){return d3.scale.linear().domain([0,n.COLLEGE_FIELD_STEPS_HORIZONTAL]).range([t.left,this._svgWidth-t.right])},n.prototype._getAngleColorScale=function(){var t="#F9FBF6",e="#FFEA59",n="#38363B",i="#38363B";return d3.scale.quantize().domain([0,360]).range([t,i,e,n])},n.prototype._generateYardlineSteps=function(){for(var t=[],e=8;e<160;e+=8)t.push(e);return t},n.prototype._clearSvg=function(){this._drawTarget.find("svg").empty()},n.prototype._drawCollegeField=function(){var t=this;this._svg.append("g").attr("class","field-wrap").append("rect").attr("class","field").attr("width",this._svgWidth).attr("height",this._svgHeight);var e=this._getVerticalStepScale(n.COLLEGE_FIELD_PADDING),i=this._getHorizontalStepScale(n.COLLEGE_FIELD_PADDING),o=this._svg.append("g").attr("class","end-lines-wrap");o.selectAll("line.endline.vertical").data([0,n.COLLEGE_FIELD_STEPS_HORIZONTAL]).enter().append("line").attr("class","endline vertical").attr("x1",i).attr("x2",i).attr("y1",e(0)).attr("y2",e(n.COLLEGE_FIELD_STEPS_VERTICAL)),o.selectAll("line.endline.horizontal").data([0,n.COLLEGE_FIELD_STEPS_VERTICAL]).enter().append("line").attr("class","endline horizontal").attr("y1",e).attr("y2",e).attr("x1",i(0)).attr("x2",i(n.COLLEGE_FIELD_STEPS_HORIZONTAL));var r=this._generateYardlineSteps();this._svg.append("g").attr("class","yardlines-wrap").selectAll("line.yardline").data(r).enter().append("line").attr("class","yardline").attr("x1",i).attr("x2",i).attr("y1",e(0)).attr("y2",e(n.COLLEGE_FIELD_STEPS_VERTICAL));[32,52].forEach(function(n){t._svg.append("g").attr("class","hashes-wrap").selectAll("line.hash").data(r).enter().append("line").attr("class","hash").attr("y1",e(n)).attr("y2",e(n)).attr("x1",function(t){return i(t)-5}).attr("x2",function(t){return i(t)+5})})},n.prototype._drawStuntsheetAtBeat=function(t,e,i){var o=t.getDots(),r=this._getHorizontalStepScale(n.COLLEGE_FIELD_PADDING),a=this._getVerticalStepScale(n.COLLEGE_FIELD_PADDING),s=this._getAngleColorScale(),l=window.isMobile?4:5,u=this._svg.append("g").attr("class","dots-wrap");u.selectAll("rect.dot").data(o).enter().append("rect").attr("class","dot").attr("x",function(t){return r(t.getAnimationState(e).x)-l/2}).attr("y",function(t){return a(t.getAnimationState(e).y)-l/2}).attr("width",l).attr("height",l).attr("fill",function(t){return t.getLabel()===i?"#F19DF5":s(t.getAnimationState(e).angle)}).style("cursor","pointer").on("click",function(t){var e=t.getLabel();$(".js-dot-labels option[data-dot-label="+e+"]").prop("selected",!0),$(".js-dot-labels").trigger("chosen:updated").trigger("change",{selected:e})});var h=t.getDotByLabel(i);if(h){var c=r(h.getAnimationState(e).x),p=a(h.getAnimationState(e).y);u.append("circle").attr("class","selected-dot-highlight").attr("cx",c).attr("cy",p).attr("r",2*l).attr("stroke","#F19DF5").attr("stroke-width","2px").attr("fill","transparent")}},t.exports=n},function(t,e,n){var i=n(26),o=n(3),r={fromJSONString:function(t){var e=JSON.parse(t);return this.fromJSON(e)},fromJSON:function(t){var e=o.parse(t.meta.version);return i.getInstance().getAppropriateLoader(e).loadFile(t)}};t.exports=r},function(t,e,n){var i=n(3),o=n(7),r=n(0),a=n(27),s=n(9),l=function(){o.apply(this,[])};r.extends(l,o),l._instance=void 0,l.getInstance=function(){return void 0===l._instance&&(l._instance=new l,l._setupInstance(l._instance)),l._instance},l._setupInstance=function(t){t.registerLoader(new i(1,0,0),new u)},l.BeatsFileLoader=function(){},r.extends(l.BeatsFileLoader,o.FileLoader);var u=function(){};r.extends(u,l.BeatsFileLoader),u.prototype.loadFile=function(t){return this.loadBeats(t.beats)},u.prototype.loadBeats=function(t){if(void 0===t)throw new s("Please upload a proper beats file.");for(var e=new a,n=0,i=0;i<t.length;i++)n+=t[i],e.addBeat(n);return e},t.exports=l},function(t,e,n){var i=n(8),o=function(t){this._beats=void 0!==t?t:[]};o.prototype.addBeat=function(t){this.addBeats([t])},o.prototype.addBeats=function(t){this._beats=i.mergeSortedArrays(this._beats,t,this._timeComparator)},o.prototype.getBeatNumAtTime=function(t){return i.binarySearchForClosestSmaller(this._beats,t,this._timeComparator)},o.prototype.getBeatTime=function(t){return this._beats[t]},o.prototype.getNumBeats=function(){return this._beats.length},o.prototype._timeComparator=function(t,e){return t-e},t.exports=o},function(t,e){var n=function(){this._animStateDelegate=null,this._sound=null,this._timedBeats=null,this._eventHandlers={},this._blockStopEvent=!1};n.eventTypes=["start","stop","finished","beat","ready"],n.prototype.setAnimationStateDelegate=function(t){this.stop(),this._animStateDelegate=t},n.prototype.setMusic=function(t){this.stop();var e=this;this._sound=t,this._sound.registerEventHandler("play",this._makeEventRouter("start")),this._sound.registerEventHandler("stop",function(){e._musicStopped()}),this._sound.registerEventHandler("finished",this._makeEventRouter("finished")),this._loadBeatsOntoSound(),this.isReady()&&this._callEventHandler("ready")},n.prototype.setBeats=function(t){this.stop(),this._beats=t,this._loadBeatsOntoSound(),this.isReady()&&this._callEventHandler("ready")},n.prototype._loadBeatsOntoSound=function(){if(this._beats&&this._sound){this._sound.clearTimedEvents();for(var t=this,e=function(){t._nextBeat()},n=1;n<this._beats.getNumBeats()-1;n++)this._sound.addTimedEvent(this._beats.getBeatTime(n),e);this._sound.addTimedEvent(this._beats.getBeatTime(this._beats.getNumBeats()-1),function(){t._animStateDelegate.nextBeat(),t._callEventHandler("beat"),t._endOfShow()})}},n.prototype.start=function(){this.stop();for(var t=-1,e=this._animStateDelegate.getShow(),n=0;n<this._animStateDelegate.getCurrentSheetNum();n++)t+=e.getSheet(n).getDuration();t+=this._animStateDelegate.getCurrentBeatNum(),this._animStateDelegate.hasNextBeat()&&t<this._beats.getNumBeats()-1?t<0?(this._animStateDelegate.nextBeat(),$(".js-beat-number").text("1"),this._sound.play(0)):this._sound.play(this._beats.getBeatTime(t)):this._endOfShow()},n.prototype.stop=function(){null!==this._sound&&this._sound.isPlaying()&&this._sound.stop()},n.prototype.isPlaying=function(){return null!==this._sound&&this._sound.isPlaying()},n.prototype.isReady=function(){return this._sound&&this._sound.isReady()&&this._beats&&null!==this._animStateDelegate},n.prototype.registerEventHandler=function(t,e){this._eventHandlers[t]=e},n.prototype._makeEventRouter=function(t){var e=this;return function(){e._callEventHandler(t)}},n.prototype._callEventHandler=function(t){this._eventHandlers[t]&&this._eventHandlers[t]()},n.prototype._nextBeat=function(){this._animStateDelegate.nextBeat(),this._callEventHandler("beat"),this._animStateDelegate.hasNextBeat()||this._endOfShow()},n.prototype._endOfShow=function(){this._stopAndBlockEvent(),this._callEventHandler("finished")},n.prototype._stopAndBlockEvent=function(){this._blockStopEvent=!0,this.stop()},n.prototype._musicStopped=function(){this._blockStopEvent?this._blockStopEvent=!1:this._callEventHandler("stop")},t.exports=n},function(t,e,n){var i=n(30),o=function(){};o.prototype.createMusicPlayer=function(){return new i},t.exports=o},function(t,e,n){var i=n(0),o=n(31),r=n(33),a=function(){this._onReadyHandler=null,this._isReady=!1,this._error=!1;var t=this;soundManager.setup({url:"./soundmanager/swf/",debugMode:!0,onready:function(){t._isReady=!0,t._informReadyEventHandler()},ontimeout:function(){t._error=!0},html5PollingInterval:20,flashPollingInterval:20})};i.extends(a,r),a.prototype.createSound=function(t){return new o(t)},a.prototype.isReady=function(){this._isReady=!0},a.prototype.onReady=function(t){this._onReadyHandler=t,this.isReady()&&this._informReadyEventHandler()},a.prototype.errorFlag=function(){return this._error},a.prototype._informReadyEventHandler=function(){null!==this._onReadyHandler&&this._onReadyHandler()},t.exports=a},function(t,e,n){var i=n(32),o=function(t){this._startTime=0,this._sound=null,this._url=t,this.reset(),void 0!==t&&this.load(t)};n(0).extends(o,i),o.prototype._eventTypes=["play","stop","finished","startLoading","finishedLoading"],o.prototype.load=function(t){this.stop(),this.unload();var e=this;this._sound=soundManager.createSound({url:t,onplay:this._makeEventRouter("play"),onstop:this._makeEventRouter("stop"),onfinish:e._handleFinished,onload:function(){e._destroyURL(),e._callEventHandler("finishedLoading")},onerror:function(t,e){console.log(this.id+" failed?",t,e),this.loaded&&this.stop()}}),this._installTimedEvents(),this._callEventHandler("startLoading"),this._sound.load()},o.prototype.unload=function(){this._stopTimedEvents=!0,this._destroyURL(),null!==this._sound&&(this._sound.destruct(),this._sound=null)},o.prototype._destroyURL=function(){null!==this._url&&(URL.revokeObjectURL(this._url),this._url=null)},o.prototype.reset=function(){this.unload(),this._eventHandlers={},this._timedEvents=[]},o.prototype.play=function(t){this._stopTimedEvents=!1,null!==this._sound&&(this._startTime=t,this._sound.play({position:t}))},o.prototype.stop=function(){this._stopTimedEvents=!0,null!==this._sound&&this._sound.stop()},o.prototype.isLoaded=function(){return null!==this._sound},o.prototype.isPlaying=function(){return null!==this._sound&&1===this._sound.playState},o.prototype.isReady=function(){return 3===this._sound.readyState},o.prototype.errorFlag=function(){return 2===this._sound.readyState},o.prototype.getError=function(){return this.errorFlag()?"Sound failed to load.":null},i.prototype.registerEventHandler=function(t,e){-1!=this._eventTypes.indexOf(t)&&(this._eventHandlers[t]=e)},o.prototype.addTimedEvent=function(t,e){var n={time:t,eventHandler:e};this._timedEvents.push(n),null!==this._sound&&this._installOneTimedEvent(n)},o.prototype.clearTimedEvents=function(){for(var t=0;t<this._timedEvents.length;t++)this._sound.clearOnPosition(this._timedEvents[t].time);this._timedEvents=[]},o.prototype._installTimedEvents=function(){for(var t=0;t<this._timedEvents.length;t++)this._installOneTimedEvent(this._timedEvents[t])},o.prototype._installOneTimedEvent=function(t){var e=this,n=t.time;this._sound.onPosition(t.time,function(){!e._stopTimedEvents&&n>e._startTime&&t.eventHandler()})},o.prototype._callEventHandler=function(t){this._eventHandlers[t]&&this._eventHandlers[t]()},o.prototype._makeEventRouter=function(t){var e=this;return function(){e._callEventHandler(t)}},o.prototype._handleFinished=function(){this._stopTimedEvents=!0,this._callEventHandler("finished")},t.exports=o},function(t,e){var n=function(){};n.prototype.load=function(t){console.log("Sound.load(...) called")},n.prototype.unload=function(){console.log("Sound.unload(...) called")},n.prototype.reset=function(){console.log("Sound.reset(...) called")},n.prototype.play=function(t){console.log("Sound.play(...) called")},n.prototype.stop=function(){console.log("Sound.stop(...) called")},n.prototype.isPlaying=function(){console.log("Sound.isPlaying(...) called")},n.prototype.isLoaded=function(){console.log("Sound.isLoaded(...) called")},n.prototype.isReady=function(){console.log("Sound.isReady(...) called")},n.prototype.errorFlag=function(){console.log("Sound.errorFlag(...) called")},n.prototype.getError=function(){console.log("Sound.getError(...) called")},n.prototype.registerEventHandler=function(t,e){console.log("Sound.registerEventHandler(...) called")},n.prototype.addTimedEvent=function(t,e){console.log("Sound.addTimedEvent(...) called")},n.prototype.clearTimedEvents=function(){console.log("Sound.clearTimedEvents(...) called")},t.exports=n},function(t,e){var n=function(){};n.prototype.createSound=function(t){console.log("MusicPlayer.createSound(...) called")},n.prototype.isReady=function(){console.log("MusicPlayer.isReady(...) called")},n.prototype.onReady=function(t){console.log("MusicPlayer.onReady(...) called")},t.exports=n},function(t,e){var n=function(t){this.setShow(t)};n.prototype.setShow=function(t){this._show=t,this._currSheet=0,this._currBeat=0,this._selectedDot=null},n.prototype.nextBeat=function(){this.hasNextBeatInCurrentSheet()?this._currBeat++:this.hasNextSheet()&&this.nextSheet()},n.prototype.prevBeat=function(){this.hasPrevBeatInCurrentSheet()?this._currBeat--:this.hasPrevSheet()&&(this.prevSheet(),this._currBeat=this.getCurrentSheet().getDuration()-1)},n.prototype.nextSheet=function(){this.hasNextSheet()?(this._currSheet++,this._currBeat=0):this._currBeat=this.getCurrentSheet().getDuration()-1},n.prototype.prevSheet=function(){this.hasPrevSheet()&&this._currSheet--,this._currBeat=0},n.prototype.hasNextBeat=function(){return this.hasNextBeatInCurrentSheet()||this.hasNextSheet()},n.prototype.hasPrevBeat=function(){return this.hasPrevBeatInCurrentSheet()||this.hasPrevSheet()},n.prototype.hasNextSheet=function(){return this._currSheet<this._show.getNumSheets()-1},n.prototype.hasPrevSheet=function(){return this._currSheet>0},n.prototype.hasNextBeatInCurrentSheet=function(){return this._currBeat<this.getCurrentSheet().getDuration()-1},n.prototype.hasPrevBeatInCurrentSheet=function(){return this._currBeat>0},n.prototype.getCurrentBeatNum=function(){return this._currBeat},n.prototype.getCurrentSheetNum=function(){return this._currSheet},n.prototype.getCurrentSheet=function(){return this._show.getSheet(this._currSheet)},n.prototype.getShow=function(){return this._show},n.prototype.getSelectedDot=function(){return this._selectedDot},n.prototype.selectDot=function(t){this._selectedDot=t},n.prototype.clearSelectedDot=function(){this._selectedDot=null},t.exports=n}]);