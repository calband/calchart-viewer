(()=>{var t={18:(t,e,i)=>{var n=i(154),o=function(t){this._beats=void 0!==t?t:[]};o.prototype.addBeat=function(t){this.addBeats([t])},o.prototype.addBeats=function(t){this._beats=n.mergeSortedArrays(this._beats,t,this._timeComparator)},o.prototype.getBeatNumAtTime=function(t){return n.binarySearchForClosestSmaller(this._beats,t,this._timeComparator)},o.prototype.getBeatTime=function(t){return this._beats[t]},o.prototype.getNumBeats=function(){return this._beats.length},o.prototype._timeComparator=function(t,e){return t-e},t.exports=o},27:(t,e,i)=>{var n=i(730),o=i(581),s=i(286),a=i(341),r=function(t,e,i,n,a,r,h){n=o.toRadians(n),this._deltaXPerStep=o.calcRotatedXPos(n)*i,this._deltaYPerStep=o.calcRotatedYPos(n)*i,this._orientation=a,this._beatsPerStep=h,numSteps=Math.floor(r/this._beatsPerStep),s.apply(this,[t,e,t+this._deltaXPerStep*numSteps,e+this._deltaYPerStep*numSteps,r])};n.extends(r,s),r.prototype.getAnimationState=function(t){return numSteps=Math.floor(t/this._beatsPerStep),new a(this._startX+this._deltaXPerStep*numSteps,this._startY+this._deltaYPerStep*numSteps,this._orientation)},r.prototype.getContinuityText=function(){var t=this._endX-this._startX,e=this._endY-this._startY,i=t<0?"S":"N",n=e<0?"W":"E";return 0==t?"Move "+Math.abs(e)+" "+n:"Move "+Math.abs(t)+" "+i},t.exports=r},30:t=>{var e=function(){this._animStateDelegate=null,this._sound=null,this._beats=null,this._eventHandlers={},this._blockStopEvent=!1,this._silentAnimationTimer=null,this._nextBeatTime=null};e.eventTypes=["start","stop","finished","beat","ready"],e.prototype.setAnimationStateDelegate=function(t){this.stop(),this._animStateDelegate=t},e.prototype.setMusic=function(t){this.stop();var e=this;this._sound=t,this._sound.registerEventHandler("play",this._makeEventRouter("start")),this._sound.registerEventHandler("stop",function(){e._musicStopped()}),this._sound.registerEventHandler("finished",this._makeEventRouter("finished")),this._loadBeatsOntoSound(),this.isReady()&&this._callEventHandler("ready")},e.prototype.setBeats=function(t){this.stop(),this._beats=t,this._loadBeatsOntoSound(),this.isReady()&&this._callEventHandler("ready")},e.prototype._loadBeatsOntoSound=function(){if(this._beats&&this._sound){this._sound.clearTimedEvents();for(var t=this,e=function(){t._nextBeat()},i=1;i<this._beats.getNumBeats()-1;i++)this._sound.addTimedEvent(this._beats.getBeatTime(i),e);this._sound.addTimedEvent(this._beats.getBeatTime(this._beats.getNumBeats()-1),function(){t._animStateDelegate.nextBeat(),t._callEventHandler("beat"),t._endOfShow()})}},e.prototype.start=function(){this.stop();for(var t=-1,e=this._animStateDelegate.getShow(),i=0;i<this._animStateDelegate.getCurrentSheetNum();i++)t+=e.getSheet(i).getDuration();t+=this._animStateDelegate.getCurrentBeatNum(),this._animStateDelegate.hasNextBeat()&&t<this._beats.getNumBeats()-1?(t<0&&(this._animStateDelegate.nextBeat(),$(".js-beat-number").text("1")),null!==this._sound&&this._sound.isReady()?this._startMusicAnimation(t):this._startSilentAnimation(t)):this._endOfShow()},e.prototype.stop=function(){null!==this._sound&&this._sound.isPlaying()&&this._sound.stop(),null!==this._silentAnimationTimer&&(cancelAnimationFrame(this._silentAnimationTimer),this._silentAnimationTimer=null)},e.prototype.isPlaying=function(){return!(null===this._sound||!this._sound.isPlaying())||null!==this._silentAnimationTimer},e.prototype.isReady=function(){return this._beats&&null!==this._animStateDelegate&&(null===this._sound||this._sound.isReady())},e.prototype.hasMusicLoaded=function(){return null!==this._sound&&this._sound.isReady()},e.prototype.hasBeatsLoaded=function(){return null!==this._beats},e.prototype.registerEventHandler=function(t,e){this._eventHandlers[t]=e},e.prototype._makeEventRouter=function(t){var e=this;return function(){e._callEventHandler(t)}},e.prototype._callEventHandler=function(t){this._eventHandlers[t]&&this._eventHandlers[t]()},e.prototype._nextBeat=function(){this._animStateDelegate.nextBeat(),this._callEventHandler("beat"),this._animStateDelegate.hasNextBeat()||this._endOfShow()},e.prototype._endOfShow=function(){this._stopAndBlockEvent(),this._callEventHandler("finished")},e.prototype._stopAndBlockEvent=function(){this._blockStopEvent=!0,this.stop()},e.prototype._musicStopped=function(){this._blockStopEvent?this._blockStopEvent=!1:this._callEventHandler("stop")},e.prototype._startMusicAnimation=function(t){t<0?this._sound.play(0):this._sound.play(this._beats.getBeatTime(t))},e.prototype._startSilentAnimation=function(t){this._callEventHandler("start");var e=t;e<0&&(e=0);var i=this._beats.getBeatTime(e),n=this._beats.getBeatTime(e+1),o=performance.now();this._nextBeatTime=o+(n-i);var s=this,a=function(t){if(null!==s._silentAnimationTimer){if(t>=s._nextBeatTime){s._nextBeat();var e=s._getCurrentOverallBeatNum()+1;if(e<s._beats.getNumBeats()){var i=s._beats.getBeatTime(e)-s._beats.getBeatTime(e-1);s._nextBeatTime=t+i}}s._silentAnimationTimer=requestAnimationFrame(a)}};this._silentAnimationTimer=requestAnimationFrame(a)},e.prototype._getCurrentOverallBeatNum=function(){for(var t=-1,e=this._animStateDelegate.getShow(),i=0;i<this._animStateDelegate.getCurrentSheetNum();i++)t+=e.getSheet(i).getDuration();return t+this._animStateDelegate.getCurrentBeatNum()},t.exports=e},88:(t,e,i)=>{var n=i(730),o=i(581),s=i(286),a=i(341),r=function(t,e,i,n,a,r,h,l){this._beatsPerStep=l,this._centerX=i,this._centerY=n,this._radius=o.calcDistance(t,e,this._centerX,this._centerY),this._startAngle=o.calcAngleAbout(t,e,i,n),isNaN(this._startAngle)&&(this._startAngle=0),this._stepAngleDelta=o.toRadians(a)/Math.floor(h/this._beatsPerStep),this._movementIsCW=this._stepAngleDelta>=0,this._orientationOffset=o.toRadians(r);var d=this.getAnimationState(h);s.apply(this,[t,e,d.x,d.y,h])};n.extends(r,s),r.prototype.getAnimationState=function(t){var e=Math.floor(t/this._beatsPerStep),i=this._startAngle+this._stepAngleDelta*e,n=this._radius*o.calcRotatedXPos(i)+this._centerX,s=this._radius*o.calcRotatedYPos(i)+this._centerY,r=o.quarterTurn(i,this._movementIsCW)+this._orientationOffset;return new a(n,s,o.toDegrees(r))},r.prototype.getMiddlePoints=function(){for(var t=this._startAngle,e=this._startX,i=this._startY,n=[],s=0;s<this._numBeats/this._beatsPerStep;s++){t+=this._stepAngleDelta;var a=this._radius*o.calcRotatedXPos(t)+this._centerX,r=this._radius*o.calcRotatedYPos(t)+this._centerY;n.push([a-e,r-i]),e=a,i=r}return n},r.prototype.getContinuityText=function(){var t=this._numBeats/this._beatsPerStep;return"GT "+(this._movementIsCW?"CW":"CCW")+" "+Math.abs(Math.floor(o.toDegrees(this._numBeats*this._stepAngleDelta)))+" deg. ("+t+" steps)"},t.exports=r},102:(t,e,i)=>{var n=i(615),o=i(836),s=i(863),a=i(30),r=i(230),h=i(310),l=window.ApplicationController=function(){this._musicPlayer=null,this._animationStateDelegate=null,this._grapher=null,this._show=null,this._animator=null};l.prototype._logLoadError=function(t,e){console.error("[Calchart Viewer] Failed to load "+t+".",e)},l.prototype.getShow=function(){return this._show},l.prototype.setShow=function(t){this._show=t,this._animationStateDelegate=new h(this._show),this._animator.setAnimationStateDelegate(this._animationStateDelegate),this._syncWithDelegate(),this._updateUIWithShow()},l.prototype.getShows=function(){return $.ajax({url:"https://calchart-server.herokuapp.com/list/",dataType:"json",xhr:function(){var t=$.ajaxSettings.xhr();return t.onprogress=function(t){if(t.lengthComputable){var e=t.loaded/t.total;$(".loading .progress-bar").css({width:35*e+"%"})}},t},success:function(t){$("<option>").appendTo(".js-select-show"),t.shows.forEach(function(t){$("<option>").attr("value",t.slug).text(t.name).appendTo(".js-select-show")}),$(".js-select-show").trigger("chosen:updated")}})},l.prototype.autoloadShow=function(t,e){if(""!==t&&void 0!==t){$(".js-select-show option[value="+t+"]").prop("selected",!0),$(".js-select-show").trigger("chosen:updated");var i=this;$.ajax({url:"https://calchart-server.herokuapp.com/get/"+t+"/",dataType:"json",xhr:function(){var t=$.ajaxSettings.xhr();return t.onprogress=function(t){if(t.lengthComputable){var e=t.loaded/t.total;$(".loading .progress-bar").css({width:35+65*e+"%"})}},t},success:function(n){try{var a=o.fromJSON(n.viewer);i.setShow(a),i._setFileInputText(".js-viewer-file-btn",t),void 0!==e&&""!==e&&(i.applyAnimationAction("selectDot",e),$("option[value="+e+"]").prop("selected",!0),$(".js-dot-labels").trigger("chosen:updated"));var r=n.beats.meta?n.beats:JSON.parse(n.beats),h=s.fromJSON(r);if(i._animator.setBeats(h),i._setFileInputText(".js-beats-file-btn",t),null===n.audio)$(".loading").remove();else{if(window.isMobile)return $(".loading").remove(),void $(".js-load-song span").text(n.audio);var l=i._musicPlayer.createSound();l.registerEventHandler("finishedLoading",function(){i._animator.setMusic(l),i._setFileInputText(".js-audio-file-btn",t),$(".loading").remove()}),l.load(n.audio)}}catch(e){i._logLoadError("autoload show '"+t+"'",e),i.displayFileInputError("Could not load show. Check console for details."),$(".loading").remove()}}})}else $(".loading").remove()},l.prototype._updateUIWithShow=function(){void 0===this._show.getTitle()?$(".js-show-title").text("Untitled Show"):$(".js-show-title").text(this._show.getTitle()),this._show.getDotLabels().forEach(function(t){$("<option>").attr("value",t).attr("data-dot-label",t).text(t).appendTo(".js-dot-labels")}),$(".js-dot-labels").trigger("chosen:updated")},l.prototype.getAnimator=function(){return this._animator},l.prototype.getAnimationStateDelegate=function(){return this._animationStateDelegate},l.prototype.applyAnimationAction=function(t){if(null!==this._animationStateDelegate&&-1!==["prevSheet","nextSheet","prevBeat","nextBeat","selectDot","clearSelectedDot"].indexOf(t)){var e=!1;this._animator.isPlaying()&&(this._animator.stop(),e=!0),-1!==["selectDot"].indexOf(t)?this._animationStateDelegate[t]([].slice.call(arguments)[1]):this._animationStateDelegate[t](),this._syncWithDelegate(),e&&this._animator.start()}},l.prototype._syncWithDelegate=function(){this._updateUIWithAnimationState(),this._grapher.draw(this._animationStateDelegate.getCurrentSheet(),this._animationStateDelegate.getCurrentBeatNum(),this._animationStateDelegate.getSelectedDot())},l.prototype._updateUIWithAnimationState=function(){$(".js-stuntsheet-total").text(this._animationStateDelegate.getCurrentSheet().getDuration());var t=this._animationStateDelegate.getCurrentBeatNum();0===t?$(".js-beat-number").text("Hup"):$(".js-beat-number").text(t);var e=this._animationStateDelegate.getCurrentSheetNum()+1,i=e+"/"+this.getShow().getNumSheets(),n=this._animationStateDelegate.getCurrentSheet().getSheetLabel();if(""===n||parseInt(n)===e?$(".js-stuntsheet-label").text(i):$(".js-stuntsheet-label").text(n+" ("+i+")"),$(".js-dot-continuity").empty(),null!==this._animationStateDelegate.getSelectedDot()){var o=this._animationStateDelegate.getSelectedDot();$(".js-selected-dot-label").text(o);var s=this._animationStateDelegate.getCurrentSheet(),a=s.getDotType(o),r=s.getContinuityTexts(a);void 0!==r&&r.forEach(function(t){$("<div>").addClass("dot-continuity").text(t).appendTo(".js-dot-continuity")})}else $(".js-selected-dot-label").text("dots")},l._instance=null,l.getInstance=function(){return null===l._instance&&(l._instance=new l),l._instance},l.prototype.init=function(){this._musicPlayer=(new r).createMusicPlayer(),this._animator=new a;var t=this;this._animator.registerEventHandler("beat",function(){t._syncWithDelegate()}),this._animator.registerEventHandler("ready",function(){t._updateAnimationControl()}),this._animator.registerEventHandler("finished",function(){t._updateAnimationControl()}),this._grapher=new n("college",$(".js-grapher-draw-target")),this._grapher.draw(null,null,null)},l.prototype._setFileInputText=function(t,e){e.length>16&&(e=e.substring(0,16)+"..."),$(t).text(e)},l.prototype._createFileHandler=function(t){return function(e){var i=e.currentTarget.files;if(i&&1===i.length){var n=new window.FileReader;n.onload=function(){t(n.result,i[0].name)},n.readAsText(i[0])}}},l.prototype._createFileURLHandler=function(t){return function(e){var i=e.currentTarget.files;i&&1===i.length&&t(URL.createObjectURL(i[0]),i[0].name)}},l.prototype.getBeatsFileHandler=function(){var t=this;return this._createFileHandler(function(e,i){try{var n=s.fromJSONString(e);t._animator.setBeats(n),t._setFileInputText(".js-beats-file-btn",i)}catch(e){$(".js-beats-file").val(""),"SyntaxError"===e.name?t.displayFileInputError("Please upload a valid beats file."):"InvalidFileTypeError"===e.name?t.displayFileInputError(e.message):t.displayFileInputError("Could not load beats file. Check console for details."),t._logLoadError("beats file '"+i+"'",e)}})},l.prototype.getViewerFileHandler=function(){var t=this;return this._createFileHandler(function(e,i){try{var n=o.fromJSONString(e);t.setShow(n),t._setFileInputText(".js-viewer-file-btn",i)}catch(e){$(".js-viewer-file").val(""),"SyntaxError"===e.name?t.displayFileInputError("Please upload a valid viewer file."):"InvalidFileTypeError"===e.name?t.displayFileInputError(e.message):t.displayFileInputError("Could not load viewer file. Check console for details."),t._logLoadError("viewer file '"+i+"'",e)}})},l.prototype.getMusicFileHandler=function(){var t=this;return this._createFileURLHandler(function(e,i){if(void 0!==e){var n=t._musicPlayer.createSound();n.registerEventHandler("finishedLoading",function(){n.errorFlag()?($(".js-audio-file").val(""),t.displayFileInputError("Please upload a valid audio file.")):(t._animator.setMusic(n),t._setFileInputText(".js-audio-file-btn",i))}),n.load(e)}})},l.prototype.mobileMusicLoader=function(){var t=this;return function(){var e=t._musicPlayer.createSound();e.registerEventHandler("finishedLoading",function(){e.errorFlag()?t.displayFileInputError("Please upload a valid audio file."):t._animator.setMusic(e)}),e.load($(this).children("span").text())}},l.prototype.displayFileInputError=function(t){$(".file-input-error").text(t).fadeIn(1e3).delay(1e3).fadeOut(500)},l.prototype.toggleAnimation=function(){this._animator.isPlaying()?this._animator.stop():this._animator.isReady()?this._animator.start():console.log("Animator is not ready!"),this._updateAnimationControl()},l.prototype._updateAnimationControl=function(){this._animator.isPlaying()?window.isMobile?$(".js-animate").addClass("playing"):$(".js-animate").text("Stop animation"):(window.isMobile?$(".js-animate").removeClass("playing"):this._animator.hasBeatsLoaded()&&!this._animator.hasMusicLoaded()?$(".js-animate").text("Animate in Silence"):$(".js-animate").text("Animate with music"),this._animator.isReady()?$(".js-animate").removeClass("disabled"):$(".js-animate").addClass("disabled"))},t.exports=l},143:t=>{var e=function(t,e,i,n,o){this._title=t,this._year=e,this._description=i,this._dotLabels=n,this._sheets=void 0===o?[]:o};e.prototype.getTitle=function(){return this._title},e.prototype.getYear=function(){return this._year},e.prototype.getDescription=function(){return this._description},e.prototype.getDotLabels=function(){return this._dotLabels},e.prototype.getSheets=function(){return this._sheets},e.prototype.getSheet=function(t){return this._sheets[t]},e.prototype.getNumSheets=function(){return this._sheets.length},e.prototype.appendSheet=function(t){this._sheets.push(t)},t.exports=e},154:t=>{var e={binarySearchBase:function(t,e){for(var i,n,o,s,a=t.length,r=0;a>0&&0!==(n=e(t[o=r+(i=Math.floor(a/2))],o));)n>0?(r+=s=i+1,a-=s):a=i},binarySearchForClosestLarger:function(t,i,n){var o;return e.binarySearchBase(t,function(t,e){var s=n(i,t);return s<=0&&(o=e),s}),o},binarySearchForClosestSmaller:function(t,i,n){var o;return e.binarySearchBase(t,function(t,e){var s=n(i,t);return s>=0&&(o=e),s}),o},binarySearch:function(t,i,n){var o;return e.binarySearchBase(t,function(t,e){var s=n(i,t);return 0===s&&(o=e),s}),o},mergeSortedArrays:function(t,e,i){for(var n=0,o=0,s=[];n<t.length&&o<e.length;)i(t[n],e[o])<0?(s.push(t[n]),n++):(s.push(e[o]),o++);for(;n<t.length;n++)s.push(t[n]);for(;o<e.length;o++)s.push(e[o]);return s}};t.exports=e},159:t=>{var e=function(){};e.prototype.load=function(t){console.log("Sound.load(...) called")},e.prototype.unload=function(){console.log("Sound.unload(...) called")},e.prototype.reset=function(){console.log("Sound.reset(...) called")},e.prototype.play=function(t){console.log("Sound.play(...) called")},e.prototype.stop=function(){console.log("Sound.stop(...) called")},e.prototype.isPlaying=function(){console.log("Sound.isPlaying(...) called")},e.prototype.isLoaded=function(){console.log("Sound.isLoaded(...) called")},e.prototype.isReady=function(){console.log("Sound.isReady(...) called")},e.prototype.errorFlag=function(){console.log("Sound.errorFlag(...) called")},e.prototype.getError=function(){console.log("Sound.getError(...) called")},e.prototype.registerEventHandler=function(t,e){console.log("Sound.registerEventHandler(...) called")},e.prototype.addTimedEvent=function(t,e){console.log("Sound.addTimedEvent(...) called")},e.prototype.clearTimedEvents=function(){console.log("Sound.clearTimedEvents(...) called")},t.exports=e},230:(t,e,i)=>{var n=i(371),o=function(){};o.prototype.createMusicPlayer=function(){return new n},t.exports=o},282:(t,e,i)=>{var n=i(730),o=i(286),s=i(341),a=function(t,e,i,n,s,a,r){this._orientation=s,this._beatsPerStep=r;var h=Math.floor(a/this._beatsPerStep);this._deltaXPerStep=(i-t)/h,this._deltaYPerStep=(n-e)/h,o.apply(this,[t,e,i,n,a])};n.extends(a,o),a.prototype.getAnimationState=function(t){var e=Math.floor(t/this._beatsPerStep);return new s(this._startX+this._deltaXPerStep*e,this._startY+this._deltaYPerStep*e,this._orientation)},a.prototype.getBeatsPerStep=function(){return this._beatsPerStep},a.prototype.getContinuityText=function(){var t=this._endX-this._startX,e=this._endY-this._startY,i=t<0?"S":"N",n=e<0?"W":"E",o=this._numBeats/this._beatsPerStep;if(t=Math.abs(t),e=Math.abs(e),0==t&&e==o)return"Move "+o+" "+n;if(0==e&&t==o)return"Move "+o+" "+i;if(e==t&&t==o)return"Move "+o+" "+i+n;var s="Even ";if(t%1!=0||e%1!=0)s+=0!=t?i:"",s+=0!=e?n:"";else{var a=[];0!=e&&a.push(Math.abs(e)+" "+n),0!=t&&a.push(Math.abs(t)+" "+i),s+=a.join(", ")}return"Even "===s&&(s+="0"),s+" ("+o+" steps)"},t.exports=a},286:(t,e,i)=>{var n=i(532),o=function(t,e,i,n,o){this._startX=t,this._startY=e,this._endX=i,this._endY=n,this._numBeats=o};o.prototype.getStartPosition=function(){return new n(this._startX,this._startY)},o.prototype.getEndPosition=function(){return new n(this._endX,this._endY)},o.prototype.getBeatDuration=function(){return this._numBeats},o.prototype.getAnimationState=function(t){console.log("getAnimationState called")},o.prototype.getContinuityText=function(){console.log("getContinuityText called")},o.prototype.getOrientation=function(){switch(this._orientation){case 0:return"E";case 90:return"S";case 180:return"W";case 270:return"N";default:return""}},t.exports=o},290:(t,e,i)=>{var n=i(730),o=i(286),s=i(341),a=function(t,e,i,n){this._orientation=i,o.apply(this,[t,e,t,e,n])};n.extends(a,o),a.prototype.getAnimationState=function(t){return new s(this._startX,this._startY,this._orientation)},a.prototype.getContinuityText=function(){return 0==this._numBeats?"":"MT "+this._numBeats+" "+this.getOrientation()},t.exports=a},310:t=>{var e=function(t){this.setShow(t)};e.prototype.setShow=function(t){this._show=t,this._currSheet=0,this._currBeat=0,this._selectedDot=null},e.prototype.nextBeat=function(){this.hasNextBeatInCurrentSheet()?this._currBeat++:this.hasNextSheet()&&this.nextSheet()},e.prototype.prevBeat=function(){this.hasPrevBeatInCurrentSheet()?this._currBeat--:this.hasPrevSheet()&&(this.prevSheet(),this._currBeat=this.getCurrentSheet().getDuration()-1)},e.prototype.nextSheet=function(){this.hasNextSheet()?(this._currSheet++,this._currBeat=0):this._currBeat=this.getCurrentSheet().getDuration()-1},e.prototype.prevSheet=function(){this.hasPrevSheet()&&this._currSheet--,this._currBeat=0},e.prototype.hasNextBeat=function(){return this.hasNextBeatInCurrentSheet()||this.hasNextSheet()},e.prototype.hasPrevBeat=function(){return this.hasPrevBeatInCurrentSheet()||this.hasPrevSheet()},e.prototype.hasNextSheet=function(){return this._currSheet<this._show.getNumSheets()-1},e.prototype.hasPrevSheet=function(){return this._currSheet>0},e.prototype.hasNextBeatInCurrentSheet=function(){return this._currBeat<this.getCurrentSheet().getDuration()-1},e.prototype.hasPrevBeatInCurrentSheet=function(){return this._currBeat>0},e.prototype.getCurrentBeatNum=function(){return this._currBeat},e.prototype.getCurrentSheetNum=function(){return this._currSheet},e.prototype.getCurrentSheet=function(){return this._show.getSheet(this._currSheet)},e.prototype.getShow=function(){return this._show},e.prototype.getSelectedDot=function(){return this._selectedDot},e.prototype.selectDot=function(t){this._selectedDot=t},e.prototype.clearSelectedDot=function(){this._selectedDot=null},t.exports=e},341:t=>{t.exports=function(t,e,i){this.x=t,this.y=e,this.angle=i}},353:(t,e,i)=>{var n=i(730),o=i(286),s=i(341),a=function(t,e,i,n,s,a){this._orientation=s,o.apply(this,[t,e,i,n,a])};n.extends(a,o),a.prototype.getAnimationState=function(t){return new s(this._endX,this._endY,this._orientation)},a.prototype.getContinuityText=function(){return"See Continuity ("+this._numBeats+" beats)"},t.exports=a},370:(t,e,i)=>{var n=i(730),o=i(925),s=i(642),a=function(t,e){this.westUp="west"==e,s.apply(this,[t])};n.extends(a,s),a.prototype.draw=function(t,e,i,n,s){var a=this,r=s.movements,h=o.getTextWidth("S",o.DEFAULT_FONT_SIZE),l=o.getTextHeight(o.DEFAULT_FONT_SIZE),d={x:t,y:s.minimal?e+l:e,width:i-2*(h+2),height:n-2*l};d.x+=i/2-d.width/2,d.y+=n/2-d.height/2,s.minimal&&(d.y-=l),this._drawBox(d.x,d.y,d.width,d.height,this.westUp,s.minimal);var u=r[0].startPosition,p={startX:u.x,startY:u.y,minX:0,minY:0,maxX:0,maxY:0,deltaX:0,deltaY:0,width:20,height:d.height/d.width*20,update:function(t,e){this.deltaX+=t,this.deltaY+=e,this.deltaX<this.minX?this.minX=this.deltaX:this.deltaX>this.maxX&&(this.maxX=this.deltaX),this.deltaY<this.minY?this.minY=this.deltaY:this.deltaY>this.maxY&&(this.maxY=this.deltaY)},getOverallX:function(){return this.maxX-this.minX},getOverallY:function(){return this.maxY-this.minY},scale:function(){var t=this.getOverallX(),e=this.getOverallY();t>this.width-4&&(this.width=t+4,this.height=d.height/d.width*this.width),e>this.height-4&&(this.height=e+4,this.width=d.width/d.height*this.height)}};r.forEach(function(t){p.update(t.deltaX,t.deltaY)}),p.scale();var c,f,g,_=d.width/p.width,y=p.startX+p.maxX-p.getOverallX()/2-p.width/2,v=p.startY+p.maxY-p.getOverallY()/2-p.height/2,m=y+p.width,S=v+p.height;this.westUp?(c=v,f=y,g=m,Math.ceil(f/8)):(c=S,f=m,g=y,Math.floor(f/8));var x={east:S,west:v,south:y,north:m,westUp:this.westUp};this._drawYardlines(d,x,_);var w=d.x+Math.abs(f-p.startX)*_,T=d.y+Math.abs(c-p.startY)*_,E=d.height/15,b=this.westUp?1:-1;this.pdf.setLineWidth(.5),this.pdf.circle(w,T,E),this._drawPosition(d,p.startY,T-d.y,Math.abs(f-p.startX)<Math.abs(f-g)/2),this.pdf.setLineWidth(.75),r.forEach(function(t){var e=b*t.deltaX*_,i=b*t.deltaY*_;a.pdf.line(w,T,w+e,T+i),w+=e,T+=i}),this.pdf.setLineWidth(.5),this.pdf.line(w-E,T-E,w+E,T+E),this.pdf.line(w+E,T-E,w-E,T+E),0!=p.deltaY&&this._drawPosition(d,p.startY+p.deltaY,T-d.y,Math.abs(f-p.startX-p.deltaX)<Math.abs(f-g)/2),this.pdf.resetFormat()},a.prototype._drawPosition=function(t,e,i,n){var s=t.y+i,a=o.getYCoordinateText(e);this.pdf.setFontSize(8),n?this.pdf.text(a,t.x+t.width-o.getTextWidth(a,8)-.5,s-.5):this.pdf.text(a,t.x+.5,s-.5),this.pdf.resetFormat()},t.exports=a},371:(t,e,i)=>{var n=i(730),o=i(474),s=i(526),a=function(){this._onReadyHandler=null,this._isReady=!1,this._error=!1;var t=this;soundManager.setup({url:"./soundmanager/swf/",debugMode:!0,onready:function(){t._isReady=!0,t._informReadyEventHandler()},ontimeout:function(){t._error=!0},html5PollingInterval:20,flashPollingInterval:20})};n.extends(a,s),a.prototype.createSound=function(t){return new o(t)},a.prototype.isReady=function(){this._isReady=!0},a.prototype.onReady=function(t){this._onReadyHandler=t,this.isReady()&&this._informReadyEventHandler()},a.prototype.errorFlag=function(){return this._error},a.prototype._informReadyEventHandler=function(){null!==this._onReadyHandler&&this._onReadyHandler()},t.exports=a},408:(t,e,i)=>{var n=i(730),o=i(286),s=i(341),a=function(t,e,i,n){this._orientation=i,o.apply(this,[t,e,t,e,n])};n.extends(a,o),a.prototype.getAnimationState=function(t){return new s(this._startX,this._startY,this._orientation)},a.prototype.getContinuityText=function(){return"Stand & Play "+this._numBeats+this.getOrientation()},t.exports=a},427:t=>{var e=function(t,e,i,n,o,s,a,r){this._sheetLabel=t,this._fieldType=e,this._dotTypes=i,this._dotTypeAssignments=n,this._continuityTexts=o,this._duration=s,this._dots=a,this._dotLabels=r};e.prototype.getSheetLabel=function(){return this._sheetLabel},e.prototype.getFieldType=function(){return this._fieldType},e.prototype.getAllDotTypes=function(){return this._dotTypes},e.prototype.getDotType=function(t){return this._dotTypeAssignments[t]},e.prototype.getContinuityTexts=function(t){return this._continuityTexts[t]},e.prototype.getDots=function(){return this._dots},e.prototype.getDotByLabel=function(t){var e=this._dotLabels.indexOf(t);return-1===e?null:this._dots[e]},e.prototype.getDuration=function(){return this._duration},t.exports=e},474:(t,e,i)=>{var n=i(159),o=function(t){this._startTime=0,this._sound=null,this._url=t,this.reset(),void 0!==t&&this.load(t)};i(730).extends(o,n),o.prototype._eventTypes=["play","stop","finished","startLoading","finishedLoading"],o.prototype.load=function(t){this.stop(),this.unload();var e=this;this._sound=soundManager.createSound({url:t,onplay:this._makeEventRouter("play"),onstop:this._makeEventRouter("stop"),onfinish:e._handleFinished,onload:function(){e._destroyURL(),e._callEventHandler("finishedLoading")}}),this._installTimedEvents(),this._callEventHandler("startLoading"),this._sound.load()},o.prototype.unload=function(){this._stopTimedEvents=!0,this._destroyURL(),null!==this._sound&&(this._sound.destruct(),this._sound=null)},o.prototype._destroyURL=function(){null!==this._url&&(URL.revokeObjectURL(this._url),this._url=null)},o.prototype.reset=function(){this.unload(),this._eventHandlers={},this._timedEvents=[]},o.prototype.play=function(t){this._stopTimedEvents=!1,null!==this._sound&&(this._startTime=t,this._sound.play({position:t}))},o.prototype.stop=function(){this._stopTimedEvents=!0,null!==this._sound&&this._sound.stop()},o.prototype.isLoaded=function(){return null!==this._sound},o.prototype.isPlaying=function(){return null!==this._sound&&1===this._sound.playState},o.prototype.isReady=function(){return 3===this._sound.readyState},o.prototype.errorFlag=function(){return 2===this._sound.readyState},o.prototype.getError=function(){return this.errorFlag()?"Sound failed to load.":null},n.prototype.registerEventHandler=function(t,e){-1!=this._eventTypes.indexOf(t)&&(this._eventHandlers[t]=e)},o.prototype.addTimedEvent=function(t,e){var i={time:t,eventHandler:e};this._timedEvents.push(i),null!==this._sound&&this._installOneTimedEvent(i)},o.prototype.clearTimedEvents=function(){for(var t=0;t<this._timedEvents.length;t++)this._sound.clearOnPosition(this._timedEvents[t].time);this._timedEvents=[]},o.prototype._installTimedEvents=function(){for(var t=0;t<this._timedEvents.length;t++)this._installOneTimedEvent(this._timedEvents[t])},o.prototype._installOneTimedEvent=function(t){var e=this,i=t.time;this._sound.onPosition(t.time,function(){!e._stopTimedEvents&&i>e._startTime&&t.eventHandler()})},o.prototype._callEventHandler=function(t){this._eventHandlers[t]&&this._eventHandlers[t]()},o.prototype._makeEventRouter=function(t){var e=this;return function(){e._callEventHandler(t)}},o.prototype._handleFinished=function(){this._stopTimedEvents=!0,this._callEventHandler("finished")},t.exports=o},519:(t,e,i)=>{var n=i(730),o=i(925),s=i(642),a=function(t,e){this.dotLabel="Dot "+e.dotLabel,this.title=e.title,this.totalSheets=e.totalSheets,this.totalPages=Math.ceil(this.totalSheets/4),s.apply(this,[t])};n.extends(a,s),a.prototype.draw=function(t){var e=this,i=t.pageNum,n=t.isLeftToRight,s=53.975,a=5,r=107.95,h=17,l=3,d=1,u=16,p={size:12,draw:function(t,n){e.pdf.text("Page ",t,n),t+=10.9,e.pdf.text(String(i),t,n-1),t+=o.getTextWidth(String(i),this.size),e.pdf.text("/",t,n),t+=1.2,e.pdf.text(String(e.totalPages),t,n+1)}},c={marginX:10,marginY:3,size:28,sheet:4*(i-1)+1,getTop:function(){return this.marginY+this.height},getBottom:function(){return this.getTop()+139.7},getLeft:function(){return this.marginX},getRight:function(){return 215.9-o.getTextWidth("SS "+this.sheet,this.size)-c.marginX},hasNext:function(){return++this.sheet<=e.totalSheets},draw:function(t,i){e.pdf.text("SS "+this.sheet,t,i)}};this.pdf.rect(s,a,r,h),this.pdf.setFontSize(u),this.pdf.text(this.title,107.95-o.getTextWidth(this.title,u)/2,a+d+o.getTextHeight(u)),this.pdf.setFontSize(u-3),this.pdf.text(this.dotLabel,107.95-o.getTextWidth(this.dotLabel,u)/2,a+d+2*o.getTextHeight(u)),this.pdf.setFontSize(p.size);var f=s+l,g=a+h/2+o.getTextHeight(p.size)/2;p.draw(f,g),f=161.925-l-o.getTextWidth("Page 0/0",p.size),p.draw(f,g),c.height=o.getTextHeight(c.size),c.width=o.getTextWidth("SS 00",c.size)+c.marginX,this.pdf.setFontSize(c.size),c.draw(c.getLeft(),c.getTop()),c.hasNext()&&(n?c.draw(c.getRight(),c.getTop()):c.draw(c.getLeft(),c.getBottom())),c.hasNext()&&(n?c.draw(c.getLeft(),c.getBottom()):c.draw(c.getRight(),c.getTop())),c.hasNext()&&c.draw(c.getRight(),c.getBottom())},t.exports=a},526:t=>{var e=function(){};e.prototype.createSound=function(t){console.log("MusicPlayer.createSound(...) called")},e.prototype.isReady=function(){console.log("MusicPlayer.isReady(...) called")},e.prototype.onReady=function(t){console.log("MusicPlayer.onReady(...) called")},t.exports=e},530:t=>{t.exports=function(t){this.message=t,this.name="InvalidFileTypeError"}},532:t=>{t.exports=function(t,e){this.x=t,this.y=e}},581:t=>{MathUtils={},MathUtils.PI_OVER_TWO=Math.PI/2,MathUtils.TWO_PI=2*Math.PI,MathUtils.DEGREES_TO_RADIANS_CONV_FACTOR=Math.PI/180,MathUtils.RADIANS_TO_DEGREES_CONV_FACTOR=1/MathUtils.DEGREES_TO_RADIANS_CONV_FACTOR,MathUtils.calcSquaredDistance=function(t,e,i,n){var o=i-t,s=n-e;return o*o+s*s},MathUtils.calcDistance=function(t,e,i,n){return Math.sqrt(this.calcSquaredDistance(t,e,i,n))},MathUtils.calcAngle=function(t,e){var i=Math.atan(-t/e);return e<0&&(i+=Math.PI),i},MathUtils.calcAngleAbout=function(t,e,i,n){return this.calcAngle(t-i,e-n)},MathUtils.calcRotatedXPos=function(t){return-Math.sin(t)},MathUtils.calcRotatedYPos=function(t){return Math.cos(t)},MathUtils.quarterTurn=function(t,e){return t+(2*e-1)*this.PI_OVER_TWO},MathUtils.wrapAngleDegrees=function(t){for(;t>=360;)t-=360;for(;t<0;)t+=360;return t},MathUtils.wrapAngleRadians=function(t){for(;t>=TWO_PI;)t-=this.TWO_PI;for(;t<0;)t+=this.TWO_PI;return t},MathUtils.toRadians=function(t){return t*this.DEGREES_TO_RADIANS_CONV_FACTOR},MathUtils.toDegrees=function(t){return t*this.RADIANS_TO_DEGREES_CONV_FACTOR},t.exports=MathUtils},590:(t,e,i)=>{var n=i(976),o=i(530),s=i(730),a=i(832),r=i(787),h=i(427),l=i(143),d=i(408),u=i(736),p=i(290),c=i(88),f=i(27),g=i(353),_=i(282),y=function(){n.apply(this,[])};s.extends(y,n),y._instance=void 0,y.getInstance=function(){return void 0===y._instance&&(y._instance=new y,y._setupInstance(y._instance)),y._instance},y._setupInstance=function(t){t.registerLoader(new a(1,0,0),new v)},y.ViewerFileLoader=function(){},s.extends(y.ViewerFileLoader,n.FileLoader);var v=function(){};s.extends(v,y.ViewerFileLoader),v.prototype.loadFile=function(t){return this.loadShow(t.show)},v.prototype.loadShow=function(t){if(void 0===t)throw new o("Please upload a proper viewer file.");var e=new l(t.title,t.year,t.description,t.labels);return this.loadSheets(e,t.sheets),e},v.prototype.loadSheets=function(t,e){for(var i=0;i<e.length;i++)t.appendSheet(this.buildIndividualSheet(e[i]))},v.prototype.buildIndividualSheet=function(t){return new h(t.label,t.field_type,t.dot_types,t.dot_labels,t.continuities,t.beats,this.buildDots(t.movements),Object.keys(t.movements))},v.prototype.buildDots=function(t){var e=[];for(var i in t)e.push(new r(i,this.buildDotMovements(t[i])));return e},v.prototype.buildDotMovements=function(t){for(var e=[],i=0;i<t.length;i++)e.push(this.buildIndividualMovement(t[i]));return e},v.prototype.buildIndividualMovement=function(t){switch(t.type){case"stand":return this.buildStandMovement(t);case"close":return this.buildCloseMovement(t);case"mark":return this.buildMarkMovement(t);case"move":return this.buildMoveMovement(t);case"goto":return this.buildGotoMovement(t);case"arc":return this.buildArcMovement(t);case"even":return this.buildEvenMovement(t);default:throw new TypeError("Movement type unrecognized.")}},v.prototype.buildStandMovement=function(t){return new d(t.x,t.y,t.facing,t.beats)},v.prototype.buildCloseMovement=function(t){return new u(t.x,t.y,t.facing,t.beats)},v.prototype.buildMarkMovement=function(t){return new p(t.x,t.y,t.facing,t.beats)},v.prototype.buildMoveMovement=function(t){return new f(t.start_x,t.start_y,t.step_size,t.direction,t.facing,t.beats,t.beats_per_step)},v.prototype.buildGotoMovement=function(t){return new g(t.from_x,t.from_y,t.to_x,t.to_y,t.facing,t.beats)},v.prototype.buildArcMovement=function(t){return new c(t.start_x,t.start_y,t.center_x,t.center_y,t.angle,t.facing_offset,t.beats,t.beats_per_step)},v.prototype.buildEvenMovement=function(t){return new _(t.x1,t.y1,t.x2,t.y2,t.facing,t.beats,t.beats_per_step)},t.exports=y},615:t=>{var e=function(t,e){if(!d3)throw new TypeError("Cannot load grapher because d3 was not found.");this._fieldType=t,this._drawTarget=e,this._svgWidth=parseInt(this._drawTarget.css("width"),10),this._svgHeight=parseInt(this._drawTarget.css("height"),10),this._svg=d3.select(this._drawTarget.get(0)).append("svg").attr("width",this._svgWidth).attr("height",this._svgHeight)};e.COLLEGE_FIELD_ASPECT_RATIO=.5333,e.COLLEGE_FIELD_STEPS_HORIZONTAL=160,e.COLLEGE_FIELD_STEPS_VERTICAL=84,e.prototype.setFieldType=function(t){this._fieldType=t},e.prototype.getFieldType=function(){return this._fieldType},e.prototype.draw=function(t,e,i){this._clearSvg(),"college"===this._fieldType&&this._drawCollegeField(),t&&e>=0&&this._drawStuntsheetAtBeat(t,e,i)},e.COLLEGE_FIELD_PADDING={left:10,right:10},e.prototype._getVerticalStepScale=function(t){var i=(this._svgWidth-t.left-t.right)*e.COLLEGE_FIELD_ASPECT_RATIO,n=(this._svgHeight-i)/2,o=n,s=this._svgHeight-n;return d3.scale.linear().domain([0,e.COLLEGE_FIELD_STEPS_VERTICAL]).range([o,s])},e.prototype._getHorizontalStepScale=function(t){return d3.scale.linear().domain([0,e.COLLEGE_FIELD_STEPS_HORIZONTAL]).range([t.left,this._svgWidth-t.right])},e.prototype._getAngleColorScale=function(){return d3.scale.quantize().domain([0,360]).range(["#F9FBF6","#38363B","#FFEA59","#38363B"])},e.prototype._generateYardlineSteps=function(){for(var t=[],e=8;e<160;e+=8)t.push(e);return t},e.prototype._clearSvg=function(){this._drawTarget.find("svg").empty()},e.prototype._drawCollegeField=function(){var t=this;this._svg.append("g").attr("class","field-wrap").append("rect").attr("class","field").attr("width",this._svgWidth).attr("height",this._svgHeight);var i=this._getVerticalStepScale(e.COLLEGE_FIELD_PADDING),n=this._getHorizontalStepScale(e.COLLEGE_FIELD_PADDING),o=this._svg.append("g").attr("class","end-lines-wrap");o.selectAll("line.endline.vertical").data([0,e.COLLEGE_FIELD_STEPS_HORIZONTAL]).enter().append("line").attr("class","endline vertical").attr("x1",n).attr("x2",n).attr("y1",i(0)).attr("y2",i(e.COLLEGE_FIELD_STEPS_VERTICAL)),o.selectAll("line.endline.horizontal").data([0,e.COLLEGE_FIELD_STEPS_VERTICAL]).enter().append("line").attr("class","endline horizontal").attr("y1",i).attr("y2",i).attr("x1",n(0)).attr("x2",n(e.COLLEGE_FIELD_STEPS_HORIZONTAL));var s=this._generateYardlineSteps();this._svg.append("g").attr("class","yardlines-wrap").selectAll("line.yardline").data(s).enter().append("line").attr("class","yardline").attr("x1",n).attr("x2",n).attr("y1",i(0)).attr("y2",i(e.COLLEGE_FIELD_STEPS_VERTICAL)),[32,52].forEach(function(e){t._svg.append("g").attr("class","hashes-wrap").selectAll("line.hash").data(s).enter().append("line").attr("class","hash").attr("y1",i(e)).attr("y2",i(e)).attr("x1",function(t){return n(t)-5}).attr("x2",function(t){return n(t)+5})})},e.prototype._drawStuntsheetAtBeat=function(t,i,n){var o=t.getDots(),s=this._getHorizontalStepScale(e.COLLEGE_FIELD_PADDING),a=this._getVerticalStepScale(e.COLLEGE_FIELD_PADDING),r=this._getAngleColorScale(),h="#F19DF5",l=window.isMobile?4:5,d=this._svg.append("g").attr("class","dots-wrap");d.selectAll("rect.dot").data(o).enter().append("rect").attr("class","dot").attr("x",function(t){return s(t.getAnimationState(i).x)-l/2}).attr("y",function(t){return a(t.getAnimationState(i).y)-l/2}).attr("width",l).attr("height",l).attr("fill",function(t){return t.getLabel()===n?h:r(t.getAnimationState(i).angle)}).style("cursor","pointer").on("click",function(t){var e=t.getLabel();$(".js-dot-labels option[data-dot-label="+e+"]").prop("selected",!0),$(".js-dot-labels").trigger("chosen:updated").trigger("change",{selected:e})});var u=t.getDotByLabel(n);if(u){var p=s(u.getAnimationState(i).x),c=a(u.getAnimationState(i).y);d.append("circle").attr("class","selected-dot-highlight").attr("cx",p).attr("cy",c).attr("r",2*l).attr("stroke",h).attr("stroke-width","2px").attr("fill","transparent")}},t.exports=e},630:(t,e,i)=>{var n=i(730),o=i(925),s=i(642);FONT_SIZE=7,DOT_RADIUS=1;var a=function(t,e){this.westUp="west"===e,s.apply(this,[t])};n.extends(a,s),a.prototype.draw=function(t,e,i,n,s){var a=this,r=o.getTextWidth("S",FONT_SIZE),h=o.getTextHeight(FONT_SIZE),l={x:t,y:e,width:i-2*(r+2),height:n-2*(h+2)};l.x+=i/2-l.width/2,l.y+=n/2-l.height/2,s.minimal&&(l.y-=h),this._drawBox(l.x,l.y,l.width,l.height,this.westUp,s.minimal);var d=l.x+l.width/2,u=l.y+l.height/2,p=s.sheet,c=s.dot.getAnimationState(0),f=this.westUp?1:-1,g=l.height/19.5,_=(this.westUp,c.x,{east:c.y+l.height/2/g,west:c.y-l.height/2/g,north:c.x+l.width/2/g,south:c.x-l.width/2/g,westUp:this.westUp});this._drawYardlines(l,_,g),this.pdf.setFontSize(FONT_SIZE),p.getDots().forEach(function(t){var e=t.getAnimationState(0),i=f*(e.x-c.x),n=f*(e.y-c.y);if(!(Math.abs(i)>14||Math.abs(n)>8)){var o=t.getLabel();0===i&&0===n?a.pdf.setFontStyle("bold"):a.pdf.setFontStyle("normal");var s=i*g+d,r=n*g+u;a.pdf.drawDot(p.getDotType(o),s,r,DOT_RADIUS),a.pdf.text(o,s-2*DOT_RADIUS,r-1.5*DOT_RADIUS)}}),this.pdf.resetFormat()},t.exports=a},637:(t,e,i)=>{var n=i(832),o=i(976),s=i(730),a=i(18),r=i(530),h=function(){o.apply(this,[])};s.extends(h,o),h._instance=void 0,h.getInstance=function(){return void 0===h._instance&&(h._instance=new h,h._setupInstance(h._instance)),h._instance},h._setupInstance=function(t){t.registerLoader(new n(1,0,0),new l)},h.BeatsFileLoader=function(){},s.extends(h.BeatsFileLoader,o.FileLoader);var l=function(){};s.extends(l,h.BeatsFileLoader),l.prototype.loadFile=function(t){return this.loadBeats(t.beats)},l.prototype.loadBeats=function(t){if(void 0===t)throw new r("Please upload a proper beats file.");for(var e=new a,i=0,n=0;n<t.length;n++)i+=t[n],e.addBeat(i);return e},t.exports=h},642:(t,e,i)=>{var n=i(925),o=function(t){this.pdf=t};o.prototype.draw=function(t,e,i,n,o){console.log("draw called")},o.prototype._drawBox=function(t,e,i,o,s,a){var r,h,l,d,u=n.getTextHeight(n.DEFAULT_FONT_SIZE),p=n.getTextWidth("S",n.DEFAULT_FONT_SIZE);s?(r="W",h="E",l="S",d="N"):(r="E",h="W",l="N",d="S"),this.pdf.setFontSize(n.DEFAULT_FONT_SIZE),a||(this.pdf.text(r,t+i/2-p/2-.5,e-2),this.pdf.text(h,t+i/2-p/2-.5,e+o+u)),this.pdf.text(l,t-p-1,e+o/2+u/2),this.pdf.text(d,t+i+1,e+o/2+u/2),this.pdf.rect(t,e,i,o),this.pdf.resetFormat()},o.prototype._drawYardlines=function(t,e,i){var o=12*t.height/47.1;this.pdf.setFontSize(o);var s,a,r,h=e.west<52&&e.east>52,l=e.west<32&&e.east>32;e.westUp?(s=t.y+(52-e.west)*i,a=t.y+(32-e.west)*i,r=5*Math.ceil(e.south/8),e.left=e.south):(s=t.y+(e.east-52)*i,a=t.y+(e.east-32)*i,r=5*Math.floor(e.north/8),e.left=e.north);for(var d=e.westUp?e.west:e.east,u=e.westUp?Math.ceil(d/4):Math.floor(d/4),p=e.westUp?-1:1,c=Math.abs(4*u-d),f=i*Math.max(0,e.north-160),g=i*Math.min(0,e.south),_=e.westUp?g:f,y=e.westUp?f:g;i*c<t.height;c+=4){var v=d-p*c;v<0||v>84||(v%84==0?this.pdf.setDrawColor(0):this.pdf.setDrawColor(200),this.pdf.hLine(t.x,t.y+c*i+_,t.width+p*(y-_)))}var m=Math.abs(8*r/5-e.left)*i,S=!1;m>4*i&&(m-=4*i,S=!0);var x=this,w=i*Math.max(0,e.east-84),T=i*Math.min(0,e.west),E=e.westUp?T:w,b=e.westUp?w:T,D=(p=e.westUp?-1:1,function(e){x.pdf.vLine(e,t.y+E,t.height+p*(b-E))});for(this.pdf.setTextColor(150);m<t.width;m+=4*i,S=!S){var F=t.x+m;if(S)this.pdf.setDrawColor(200),D(F);else{this.pdf.setDrawColor(0),D(F),l&&this.pdf.hLine(F-1.5,a,3),h&&this.pdf.hLine(F-1.5,s,3);var L="";1===(L=String(r<50?r:100-r)).length&&(L="0"+L);var A=n.getTextWidth(L,o)/2;if(m>A&&this.pdf.text(L[0],F-A-.5,t.y+t.height-2),m<t.width-A&&this.pdf.text(L[1],F+.5,t.y+t.height-2),(r+=e.westUp?5:-5)<0||r>100)break}}this.pdf.resetFormat()},t.exports=o},705:(t,e,i)=>{var n=i(730),o=i(925),s=i(642),a=function(t){s.apply(this,[t])};n.extends(a,s),a.prototype.draw=function(t,e,i,n,s){var a={x:t+2,y:e+1,size:10},r=s.dotType,h=i-4-6,l=n-2-3,d=s.sheet.getContinuityTexts(r);if(this.pdf.rect(t,e,i,n-1.5),void 0!==d){for(d=d.map(function(t){for(;o.getTextWidth(t,a.size)>h;)a.size--;return t});d.length*o.getTextHeight(a.size)>l;)a.size--;this.pdf.drawDot(r,a.x+1.5,a.y+2,1.5),a.x+=4,this.pdf.setFontSize(10),this.pdf.text(":",a.x,a.y+o.getTextHeight(10)),this.pdf.setFontSize(a.size),a.x+=2,a.y+=o.getTextHeight(a.size),this.pdf.text(d,a.x,a.y),this.pdf.resetFormat()}},t.exports=a},707:(t,e,i)=>{var n=i(730),o=i(925),s=i(642),a=function(t,e){this.westUp="west"===e,s.apply(this,[t])};n.extends(a,s),a.prototype.draw=function(t,e,i,n,s){var a=this,r=o.getTextWidth("S",o.DEFAULT_FONT_SIZE),h=(o.getTextHeight(o.DEFAULT_FONT_SIZE),i-2*(r+1.5)),l={x:t,y:e,width:h,height:84*h/160};l.x+=i/2-l.width/2,l.y+=n/2-l.height/2,this._drawBox(l.x,l.y,l.width,l.height,this.westUp,s.minimal);var d=s.sheet.getDots(),u=s.dot,p=l.width/160;this.pdf.setLineWidth(.2),this.pdf.setDrawColor(150),this.pdf.vLine(l.x+l.width/2,l.y,l.height);for(var c=l.width/21,f=l.y+32*p,g=l.y+52*p,_=0;_<21;_+=2)t=l.x+_*c,this.pdf.hLine(t,f,c),this.pdf.hLine(t,g,c);this.pdf.setFillColor(210),d.forEach(function(t){if(t!==u){var e=t.getAnimationState(0);a.westUp||(e.x=160-e.x,e.y=84-e.y),a.pdf.circle(l.x+e.x*p,l.y+e.y*p,.5,"F")}});var y=u.getAnimationState(0);this.westUp||(y.x=160-y.x,y.y=84-y.y),t=y.x*p,e=y.y*p,this.pdf.setFillColor(0),this.pdf.circle(l.x+t,l.y+e,.5,"F"),this.pdf.resetFormat()},t.exports=a},730:t=>{var e={extends:function(t,e){var i=function(){};i.prototype=e.prototype,t.prototype=new i},getURLValue:function(t){var e=this.getAllURLParams();return void 0!==e[t]?e[t]:null},getAllURLParams:function(){for(var t={},e=window.location.search.substr(1).split("&"),i=0;i<e.length;i++){var n=e[i].split("="),o=decodeURIComponent(n[0]),s=decodeURIComponent(n[1]);t[o]=s}return t}};t.exports=e},736:(t,e,i)=>{var n=i(730),o=i(286),s=i(341),a=function(t,e,i,n){this._orientation=i,o.apply(this,[t,e,t,e,n])};n.extends(a,o),a.prototype.getAnimationState=function(t){return new s(this._startX,this._startY,this._orientation)},a.prototype.getContinuityText=function(){return"Close "+this.getOrientation()},t.exports=a},763:(t,e,i)=>{var n=i(730),o=i(925),s=i(642),a=function(t){s.apply(this,[t])};n.extends(a,s),a.prototype.draw=function(t,e,i,n,s){var a=this._getContinuityTexts(s.dot),r=o.getTextHeight(10),h=e+1,l=t+2,d=0,u=0;this.pdf.rect(t,e,i,n),this.pdf.setFontSize(10);for(var p=0;p<a.length;p++){var c=a[p],f=o.getTextWidth(c,10);if(f>d&&(d=f),(u+=r+.7)>n-r-1){if(!(d<i/2&&l<i/2)){this.pdf.text("...",l,h+u-r/2);break}l+=i/2,u=r+.7}this.pdf.text(c,l,h+u)}var g=s.duration+" beats total";this.pdf.text(g,t+i/2-o.getTextWidth(g,10)/2-3,e+n-1),this.pdf.resetFormat()},a.prototype._getContinuityTexts=function(t){var e=[];return t.getMovementCommands().forEach(function(t){var i=t.getContinuityText();""!==i&&e.push(i)}),e},t.exports=a},787:t=>{var e=function(t,e){this._label=t,this._movements=e};e.prototype.getLabel=function(){return this._label},e.prototype.getMovementCommands=function(){return this._movements},e.prototype.getAnimationState=function(t){for(var e=0;e<this._movements.length;e++){if(t<this._movements[e].getBeatDuration())return this._movements[e].getAnimationState(t);t-=this._movements[e].getBeatDuration()}},t.exports=e},832:t=>{var e=function(t,e,i){this._major=t,this._minor=e,this._revision=i};e.prototype.stringify=function(){return this._major+"."+this._minor+"."+this._revision},e.prototype.compareTo=function(t){var e=this._major-t._major;return 0!=e||0!=(e=this._minor-t._minor)?e:e=this._revision-t._revision},e.parse=function(t){var i=t.split(".");return new e(parseInt(i[0]),parseInt(i[1]),parseInt(i[2]))},t.exports=e},836:(t,e,i)=>{var n=i(590),o=i(832),s={fromJSONString:function(t){var e=JSON.parse(t);return this.fromJSON(e)},fromJSON:function(t){var e=o.parse(t.meta.version);return n.getInstance().getAppropriateLoader(e).loadFile(t)}};t.exports=s},863:(t,e,i)=>{var n=i(637),o=i(832),s={fromJSONString:function(t){var e=JSON.parse(t);return this.fromJSON(e)},fromJSON:function(t){var e=o.parse(t.meta.version);return n.getInstance().getAppropriateLoader(e).loadFile(t)}};t.exports=s},905:(t,e,i)=>{var n=i(925),o=i(519),s=i(705),a=i(763),r=i(370),h=i(707),l=i(630),d=10,u=[{x:d,y:24},{x:117.95,y:24},{x:d,y:155.7},{x:117.95,y:155.7}],p=139.7-22,c=function(t,e){this.pdf=jsPDF("portrait","mm","letter"),this.show=t,this.dots=e,this.sheets=t.getSheets(),this.data=null,this.current=0,this.total=this.dots.length*this.sheets.length};c.prototype.generate=function(t){for(var e=Math.ceil(this.sheets.length/4)+2,i=0;i<this.dots.length;i++)0!==i&&this.pdf.addPage(),this.dot=this.dots[i],this._generate(t),e%2==1&&i<this.dots.length-1&&this.pdf.addPage();this.data=this.pdf.output("datauristring")},c.prototype._generate=function(t){this.headerWidget=new o(this.pdf,{dotLabel:this.dot,title:this.show.getTitle(),totalSheets:this.sheets.length}),this.dotContinuityWidget=new s(this.pdf),this.individualContinuityWidget=new a(this.pdf),this.movementDiagramWidget=new r(this.pdf,t["md-orientation"]),this.birdsEyeWidget=new h(this.pdf,t["bev-orientation"]),this.surroundingDotsWidget=new l(this.pdf,t["sd-orientation"]),this._addFrontSheet();for(var e=this._getMovements(),i=0;i<Math.ceil(this.sheets.length/4);i++){this.pdf.addPage();for(var n=[],d=0;d<4&&(f=4*i+d)!=this.sheets.length;d++)n.push(this.sheets[f]);this.headerWidget.draw({pageNum:i+1,isLeftToRight:"ltr"===t["layout-order"]}),this.pdf.setDrawColor(150),this.pdf.vLine(107.95,24,279.4-24),this.pdf.hLine(0,142.2,215.9),this.pdf.setDrawColor(0);var c=[0,1,2,3];for("ttb"===t["layout-order"]&&(c=[0,2,1,3]),d=0;d<n.length;d++){var f,g=u[c[d]].x,_=u[c[d]].y,y=(f=n[d]).getDotByLabel(this.dot);this.dotContinuityWidget.draw(g,_,87.95,p/6,{sheet:f,dotType:f.getDotType(this.dot)}),this.individualContinuityWidget.draw(g,_+p/6,43.975,39.23333333333333,{dot:y,duration:f.getDuration()}),this.movementDiagramWidget.draw(g+43.975+1,_+p/6,43.975,39.23333333333333,{movements:e[4*i+d]}),this.surroundingDotsWidget.draw(g,_+p/2+2,87.95,56.849999999999994,{sheet:f,dot:y}),this.current++;var v=this.current/this.total;$(".js-pdf-loading .progress-bar").css({width:50+50*v+"%"})}}this._addEndSheet(e)},c.prototype._getMovements=function(){var t=[],e=this.dot;return this.sheets.forEach(function(i){var n=[],o=i.getDotByLabel(e).getMovementCommands(),s=o[0].getStartPosition();o.forEach(function(t){var e=t.getEndPosition();void 0===t.getMiddlePoints?n.push({startPosition:s,deltaX:e.x-s.x,deltaY:e.y-s.y}):t.getMiddlePoints().forEach(function(t){n.push({startPosition:s,deltaX:t[0],deltaY:t[1]})}),s=e}),t.push(n)}),t},c.prototype._addFrontSheet=function(){this.pdf.vLine(107.95,10,269.4);var t=this.show.getTitle()+" - Dot "+this.dot;this.pdf.setFontSize(15),this.pdf.text(t,107.95-n.getTextWidth(t,15)/2,8),n.getTextHeight(10);for(var e=n.getTextWidth("00",20)+4,i=n.getTextHeight(20),o=107.95-e-6-d,s=84*o/160,a=0,r=10,h=0;h<this.sheets.length;h++){var l=this.sheets[h],u=l.getDotByLabel(this.dot);r+s>274.4&&(0===a?a=99.95:(this.pdf.addPage(),this.pdf.vLine(107.95,10,269.4),this.pdf.setFontSize(15),this.pdf.text(t,107.95-n.getTextWidth(t,15)/2,8),a=0),r=10),this.pdf.setFontSize(20),this.pdf.text(String(h+1),a+2+d,r+.5+i);var p={sheet:l,dot:u,minimal:!0};this.birdsEyeWidget.draw(a+e+2+d,r+.5,o,s,p),r+=s+1}},c.prototype._addEndSheet=function(t){this.pdf.addPage(),this.pdf.vLine(107.95,10,269.4);var e=this.show.getTitle()+" - Dot "+this.dot;this.pdf.setFontSize(15),this.pdf.text(e,107.95-n.getTextWidth(e,15)/2,8);for(var i=n.getTextHeight(10),o=n.getTextWidth("00",20)+4,s=n.getTextHeight(20),a=77.95-o-6-d,r=0,h=10,l=0;l<this.sheets.length;l++){var u=this.sheets[l],p=u.getDotByLabel(this.dot),c=25,f=(p.getMovementCommands().length+1)*(i+1)+1;f>c&&(c=f),h+c>274.4&&(0==r?r=99.95:(this.pdf.addPage(),this.pdf.vLine(107.95,10,269.4),this.pdf.setFontSize(15),this.pdf.text(e,107.95-n.getTextWidth(e,15)/2,8),r=0),h=10),this.pdf.setFontSize(20),this.pdf.text(String(l+1),r+2+d,h+.5+s),this.individualContinuityWidget.draw(r+o+2+d,h+.5,a,c,{dot:p,duration:this.sheets[l].getDuration()});var g={sheet:u,dot:p,minimal:!0,movements:t[l]};this.movementDiagramWidget.draw(r+o+a+2+d,h+.5,30,c,g),h+=c+1}},t.exports=c},925:t=>{PDFUtils={},PDFUtils.DUMMY_PDF=jsPDF("portrait","mm","letter"),PDFUtils.SCALE_FACTOR=PDFUtils.DUMMY_PDF.internal.scaleFactor,PDFUtils.DEFAULT_FONT_SIZE=12,PDFUtils.getTextWidth=function(t,e){return this.DUMMY_PDF.getStringUnitWidth(t)*e/this.SCALE_FACTOR},PDFUtils.getTextHeight=function(t){return t/this.SCALE_FACTOR},PDFUtils.getXCoordinateText=function(t){var e=t%8,i=5*Math.floor(t/8);return e>4&&(i+=5),i=i<50?"S"+i:50==i?"50":"N"+(100-i),e>4?(e=8-e,(e=Math.round(10*e)/10)+"S "+i):0==e?i:(e=Math.round(10*e)/10)+"N "+i},PDFUtils.getYCoordinateText=function(t){function e(t){return Math.round(10*t)/10}return 0==t?"WS":t<=16?e(t)+" WS":t<32?e(32-t)+"W WH":32==t?"WH":t<=40?e(t-32)+"E WH":t<52?e(52-t)+"W EH":52==t?"EH":t<=68?e(t-52)+"E EH":t<84?e(84-t)+" ES":"ES"},function(t){"use strict";t.drawDot=function(t,e,i,n){return this.setLineWidth(.1),-1!=t.indexOf("open")?(this.setFillColor(255),this.circle(e,i,n,"FD")):(this.setFillColor(0),this.circle(e,i,n,"FD")),n+=.1,-1==t.indexOf("backslash")&&-1==t.indexOf("x")||this.line(e-n,i-n,e+n,i+n),-1==t.indexOf("forwardslash")&&-1==t.indexOf("x")||this.line(e-n,i+n,e+n,i-n),this.setLineWidth(.3),this.setFillColor(0),this},t.resetFormat=function(){return this.setFontSize(PDFUtils.DEFAULT_FONT_SIZE),this.setFontStyle("normal"),this.setTextColor(0),this.setDrawColor(0),this.setFillColor(255),this.setLineWidth(.3),this},t.hLine=function(t,e,i){this.line(t,e,t+i,e)},t.vLine=function(t,e,i){this.line(t,e,t,e+i)}}(jsPDF.API),t.exports=PDFUtils},976:(t,e,i)=>{var n=i(154),o=(i(832),function(){this._loaders=[]});o.prototype.registerLoader=function(t,e){var i=n.binarySearchForClosestLarger(this._loaders,t,o._versionLocator),s={version:t,loader:e};this._loaders.splice(i,0,s)},o.prototype.getAppropriateLoader=function(t){var e=n.binarySearchForClosestSmaller(this._loaders,t,o._versionLocator);return this._loaders[e].loader},o._versionLocator=function(t,e){return t.compareTo(e.version)},(o.FileLoader=function(){}).prototype.loadFile=function(t){console.log("FileLoader.loadFile(...) called")},t.exports=o}},e={};function i(n){var o=e[n];if(void 0!==o)return o.exports;var s=e[n]={exports:{}};return t[n](s,s.exports,i),s.exports}var n=i(102),o=i(730),s=i(905),a=null,r=function(t,e){var i="mousedown",n="mouseup mouseleave";void 0!==window.ontouchstart&&(i="touchstart",n="touchend touchcancel"),$(t).on(i,function(){e(),a=setTimeout(function(){a=setInterval(e,50)},500)}).on(n,function(){clearTimeout(a)})};$(document).ready(function(){$.getJSON("build/build-info.json").done(function(t){console.log("[Calchart Viewer] Build info:",t.branch+"@"+t.commit,"built",t.builtAt)}).fail(function(){console.log("[Calchart Viewer] Build info unavailable.")});var t=n.getInstance();t.init(),$(".js-beats-file-btn").click(function(){$(".js-beats-file").click()}),$(".js-beats-file").change(t.getBeatsFileHandler()),$(".js-viewer-file-btn").click(function(){$(".js-viewer-file").click()}),$(".js-viewer-file").change(t.getViewerFileHandler()),$(".js-audio-file-btn").click(function(){$(".js-audio-file").click()}),$(".js-audio-file").change(t.getMusicFileHandler()),$(".js-load-song").click(t.mobileMusicLoader()),r(".js-prev-beat",function(){t.applyAnimationAction("prevBeat")}),$(".js-prev-stuntsheet").click(function(){t.applyAnimationAction("prevSheet")}),r(".js-next-beat",function(){t.applyAnimationAction("nextBeat")}),$(".js-next-stuntsheet").click(function(){t.applyAnimationAction("nextSheet")}),$(window).keydown(function(e){if(39===e.keyCode)t.applyAnimationAction("nextBeat");else if(37===e.keyCode)t.applyAnimationAction("prevBeat");else if(32===e.keyCode){var i=t.getAnimator();i&&i.isReady()&&t.toggleAnimation()}}),$(".js-animate").click(function(){t.toggleAnimation()}),$(".js-generate-continuity").click(function(){var t=$(".js-select-show").val(),e=$(".js-dot-labels").val();window.location.href="pdf.html?show="+t+"&dots="+e+"&md-orientation=west&bev-orientation=west&sd-orientation=west&layout-order=ltr"}),$(".js-quick-generate-continuity").click(function(){$(".js-viewer-file").val();var e=$(".js-dot-labels").val();window.generator=new s(t._show,[e]);try{window.generator.generate({"md-orientation":"west","bev-orientation":"west","sd-orientation":"west","layout-order":"ltr"}),window.generator.pdf.save()}catch(t){throw console.log("Error occured ",t),$(".file-input-error").text("Error occured "+t).fadeIn(1e3).delay(1e3).fadeOut(500),t}}),$(".js-dot-labels").chosen({allow_single_deselect:!0,width:"90px"}).change(function(e,i){i?(t.applyAnimationAction("selectDot",i.selected),$(".js-quick-generate-continuity").removeClass("disabled")):(t.applyAnimationAction("clearSelectedDot"),$(".js-quick-generate-continuity").addClass("disabled"))}),$(".js-select-show").chosen({width:"150px",disable_search_threshold:4,allow_single_deselect:!0}).change(function(){window.location.search="show="+$(this).val()}),t.getShows().complete(function(){var e=o.getAllURLParams();t.autoloadShow(e.show,e.dot)}).error(function(t){alert("Could not load shows from the server"),$(".loading").remove()})})})();